<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<title>The JS9 Public API</title>
<style>
  .container{
    padding: 10px;
  }

  h3 , h4 {
    text-align: center;
  }

  h4 {
    font-size: larger;
  }

  h5 {
    font-size: larger;
    text-decoration: underline;
  }

  code.api {
    font-size: larger;
  }
</style>
</head>
<body>
<div class="container">
<h3>The JS9 Public API</h3>

<p>
The JS9 Public API provides a JavaScript programming interface for
interacting with JS9. Obviously, all of JS9 JavaScript code is
available to you within a web page, but the public API is designed to
stable and well-documented for users and web designers. It also will
provide the basis for planned language bindings (python, perhaps C/Fortran).
<p>
In general, the public API routines act on the current image being
displayed in the default JS9 div element. Since most web pages will
have only a single JS9 div element, this behavior is usually what you
want. It parallels DS9's behavior in which XPA commands act on the
currently displayed image. For example, to change the colormap of the
current image, use:
<pre>
    JS9.SetColormap("cool");
</pre>

<p>
However, for cases where multiple JS9 div elements are defined on a
single page, you can specify the specific div element to process by
adding an <b> display object</b> argument to the calling sequence with
a single <b>display</b> property:
<pre>
    {display: [div_id]}
</pre>
where [div_id] is the id of the target JS9 div element. For example,
if two JS9 divs with ids "JS9" and "myJS9", respectively, are present
on a single web page, you can set the colormap of the second one this way:
<pre>
    JS9.SetColormap("cool", {display: "myJS9"})
</pre>
Note that this <b>display object</b> contains only the <b>display</b>
property and always is specified as the final argument in a call.
<p>
The display property can specify an image handle instead of a JS9 div
id. When the image handle in question points to the currently
displayed image, this alternate usage is nothing more than a trivial
optimization.  Thus, to call a routine such as
<a href="#JS9.WCSToPix">JS9.WCSToPix()</a>
or
<a href="#JS9.PixToWCS">JS9.PixtoWCS()</a>:
<pre>
    var im = JS9.GetImage({display: "myJS9"});
    for(i=0; i&lt;1000; i++){
      x = ...
      y = ... 
      wcs = JS9.PixtoWCS(x, y, {display: im});
      console.log("%s %s -> %s %s", x, y, wcs.ra, wcs.dec);
    }
</pre>
However, the image handle does not need to point to the currently
displayed image. When it does not, the public routine will act on the
image associated with the image handle, not the current image.  In
particular, you can use
<a href="#JS9.LookupImage"><b>JS9.LookupImage()</b></a>
to get the image
handle of any image, and then act on that image. For example, if two
images, foo1.fits and foo2.fits, are loaded into a JS9 display, and
foo1.fits is currently being displayed, you can close foo2.fits this way:
<pre>
    var im = JS9.LookupImage("foo2.fits");
    if( im ){
        JS9.CloseImage({display: im});
    }
</pre>
<p>
The optional <b>display object</b> argument generally is not
mentioned in the routines below, but it is always available.

<p>
Choose from the following sections:
<ul>
<li><a href="#load">Loading Images</a>
<li><a href="#images">Working with Images</a>
<li><a href="#regions">Working with Regions</a>
<li><a href="#shapes">Working with Shape Layers</a>
<li><a href="#gestures">Mouse/Touch Gestures</a>
<li><a href="#server">Server-side Analysis</a>
<li><a href="#displays">Working with Displays</a>
<li><a href="#misc">Miscellaneous</a>
<li><a href="#proto">Prototypes (in development)</a>
<li><a href="#history">API Change History</a>
</ul>

<p><hr>
<h4 id="load">Loading Images</h4>

<h5 id="JS9.Load">Load an image into JS9</h5>
<p> 
<code class="api">JS9.Load(url, opts)</code>
<p>
where:
<ul>
<li><b>url</b>: url, fitsy object, in-memory FITS, or FITS blob
<li><b>opts</b>: optional object or json string containing image parameters
</ul>
<p>
Load a FITS file or a PNG <b>representation file</b> into JS9.
You also can pass an in-memory buffer containing a FITS file, or a string
containing a base64-encoded FITS file.
<p>
Finally, you can pass a fits object containing the following properties:
<ul>
<li><b>naxis</b>: number of axes in the image
<li><b>axis</b>: array of image dimensions for each axis or ...
<li><b>naxis[n]</b> image dimensions of each axis (naxis1, naxis2, ...)
<li><b>bitpix</b>: FITS bitpix value
<li><b>head</b>: object containing header keywords as properties
<li><b>image</b>: typed data array containing image data (native format)
<li><b>dmin</b>: data min (optional)
<li><b>dmax</b>: data max (optional)
</ul>
The difference between
<a href="#JS9.RefreshImage"><b>JS9.RefreshImage()</b></a>
and <b>JS9.Load()</b> is
that the former updates the data into an existing image, while the latter adds
a completely new image to the display.
<p>
To override default image parameters, pass the image opts argument:
<pre>
    JS9.Load("png/m13.png", {scale:"linear", colormap:"sls"});
</pre>
<p>
If an onload callback function is specified in opts, it will be called
after the image is loaded:
<pre>
    JS9.Load("fits/3c273.fits", {scale: "linear", onload: func});
</pre>
The image handle is passed as the first argument to the callback.
<p>
To load an image into a specified display, pass the <b>display object</b> as the last argument:
<pre>
    JS9.Load("fits/3c273.fits", {scale: "linear"}, {display: "myJS9"});
</pre>
<p>
See <a href="./yourdata.html">Displaying Your Data</a> for further discussion of
how to use this routine.

<h5 id="JS9.LoadWindow">Load an image into a light window or a new (separate) window</h5>
<p>
<code class="api">JS9.LoadWindow(url, opts, type, html, winopts)</code>
<p>
where:
<ul>
<li><b>url</b>: url to load
<li><b>opts</b>: optional object or json string containing image parameters and/or the div id
<li><b>type</b>: "light" or "new" 
<li><b>html</b>: html for the new page (default is to display a menubar above the image)
<li><b>winopts</b>: for "light", optional dhtml window options
</ul>
returns:
<ul>
<li><b>id</b>: the id of the JS9 display div
</ul>
This routine will load an image into a light-weight window or an entirely new
window. The <b>url</b> and <b>opts</b> arguments are identical to the standard
<a href="#JS9.Load"><b>JS9.Load()</b></a>
call, except that <b>opts</b> can contain an <b>id</b>
string to specify the id of the JS9 div being created. If no id is specified,
a unique id is generated. In either case, the id is returned by the call.
<p>
The <b>type</b> argument determines whether to create
a light-weight window or a new (separate) window.
<p>
By default, the new window will contain a Menubar above an image display area:
<pre>
    &lt;div class='JS9Menubar' id='[id]Menubar'&gt;&lt;/div&gt;
    &lt;div class='JS9' id='[id]'&gt;&lt;/div&gt;
</pre>
You can use the <b>html</b> argument to supply different web page elements
for the window. Furthermore, if you create a light window, a default
set of DynamicDrive dhtmlwindow parameters will be used to make the
window the correct size for the default html:
<pre>
    "width=512px,height=542px,center=1,resize=1,scrolling=1"
</pre>
You can supply your own parameters for the new dhtmlwindow using the
<b>winOpts</b> argument. See:
<a href="http://www.dynamicdrive.com/dynamicindex8/dhtmlwindow/index.htm">
DynamicDrive</a> for more information about their light-weight window.
<p>
To create a new light window without loading an image, use:
<pre>
    JS9.LoadWindow(null, null, "light");
</pre>
<p>
See js9create.html for examples of how to use this routine.

<h5 id="JS9.LoadProxy">Load an image URL into JS9 using a proxy server</h5>
<p> 
<code class="api">JS9.LoadProxy(url, opts)</code>
<p>
where:
<ul>
<li><b>url</b>: remote URL link to load
<li><b>opts</b>: optional object or json string containing image parameters
</ul>
<p>
Load a FITS, PNG, or JPEG file specified by an arbitrary URL into JS9 using the
JS9 back-end helper as a proxy server.
<p>
For security reasons, JavaScript contained in one web page can
access data in another web page only if both web pages have the
same origin (i.e., basically coming from the same host).  This
policy is called the 
<a href="https://en.wikipedia.org/wiki/Same-origin_policy">
Same Origin Policy</a>. This means that JS9 cannot load a image files
(i.e., FITS, PNG, or JPG) from an arbitrary URL without using special
techniques.
<p>
One such technique is
<a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">
Cross-Origin Resource Sharing</a>, by which the second server grants
permission to access its image data. Dropbox is CORS-enabled, so that
image files can be loaded directly into JS9. But obviously this requires
that explicit permission be granted by the other server.
<p>
A second technique is to use a proxy server: the URL is not
loaded directly into JS9, but instead is copied back to the
server from which JS9 itself was loaded. The file is then retrieved by
JS9 from this server so that the "same origin" rules are not violated.
<p>
The JS9 Node.js back-end helper can be configured to support
proxy server mode by setting the <b>JS9.globalOpts.loadProxy</b>
property. In addition, the back-end server must be configured to
support temporary working directories for each loaded page by setting
the <b>JS9.globalOpts.workDir</b> property. If the back-end server is
thus configured as a proxy server, JS9 will support the <b>JS9.LoadProxy()</b>
call and allow you to load FITS, PNG, and JPG files from arbitrary URLs. 
JS9 also will display a <b>open link via proxy</b> menu option in the
<b>File</b> menu.
<p>
The <b>JS9.LoadProxy()</b> call takes a URL as its first
argument. This URL will be retrieved using curl or wget and stored on
the back-end server in a directory specifically tied to the web
page. (The directory and its contents will be deleted when the page is
unloaded.) JS9 then will load the file from this directory. Note that
since the file resides on the back-end server, all back-end analysis 
defined on that server is available.
<p>
To override default image parameters, pass the image opts argument:
<pre>
    JS9.LoadProxy("http://hea-www.cfa.harvard.edu/~eric/coma.fits", {scale:"linear", colormap:"sls"});'
</pre>
<p>
If an onload callback function is specified in opts, it will be called
after the image is loaded:
<pre>
    JS9.LoadProxy("http://hea-www.cfa.harvard.edu/~eric/coma.fits", {scale: "linear", onload: func});'
</pre>
The image handle is passed as the first argument to the callback.
<p>
To load an image into a specified display, pass the <b>display object</b> as the last argument:
<pre>
    JS9.LoadProxy("http://hea-www.cfa.harvard.edu/~eric/coma.fits", {scale: "linear"}, {display: "myJS9"});'
</pre>
<p>
Note again that not all back-end servers support the proxy functionality.
The main 
<a href="https://js9.si.edu">JS9 web site</a> does support proxy service, and
can be used to view images from arbitrary URLs.

<h5 id="JS9.Preload">Load one or more images when the web page is ready</h5>
<p>
<code class="api">JS9.Preload(url1, opts1, url2, opts2, ... url2, optsn)</code>
<p>
where:
<ul>
<li><b>url</b>: url to load
<li><b>opts</b>: optional object or json string containing image parameters
</ul>
This routine will pre-load images into a JS9 display. It can be added
to the web page body element using the onload() JavaScript call or
called in a JavaScript init routine tied to onload. See index.html and
js9preload.html for examples.
<p>
It is worth emphasizing that <b>JS9.Preload()</b> should not be called
until the web page is fully loaded, since JS9 itself is not fully
initialized until then. It is for this reason that <b>JS9.Preload()</b>
generally is called using an onload routine tied to the web page body.

<p>
You can load URLs outside the current web page domain if you are running a
JS9 helper which has enabled the server side <b>Proxy Load</b> capability.
See <a href="serverside.js">Server-side Analysis Tasks</a> for more information.
  
<h5 id="JS9.GetLoadStatus">Get Load Status</h5>
<p> 
<code class="api">status = JS9.GetLoadStatus(id)</code>
<p>
where:
<ul>
<li><b>id</b>: the id of the file that was loaded into JS9
</ul>
returns:
<ul>
<li><b>status</b>: status of the load
</ul>
This routine returns the status of the load process for this image. A
status of "complete" means that the image is fully loaded. Other statuses
include:
<ul>
<li> loading: the image is in process of loading
<li> error: image did not load due to an error
<li> other: another image is loaded into this display
<li> none: no image is loaded into this display
</ul>
Thus, to check for image load, one can do this in python:
<pre>
    tfits = "foo.fits"
    hdul = fits.open(tfits)
    ...
    j = JS9()
    j.SetFITS(hdul, tfits)
    while j.GetLoadStatus(tfits) != "complete":
        time.sleep(0.1)
    j.SetZoom(2)
</pre>

<p><hr>
<h4 id="images">Working with Images</h4>

<h5 id="JS9.GetImage">Get image handle for the current image</h5>
<p>
<code class="api">im = JS9.GetImage()</code>
<p>
returns:
<ul>
<li><b>im</b>: image handle
</ul>
<p>
The routine returns the image handle associated with the current image.
<p>
The returned image handle can be passed in the display object.  This
is marginally more efficient than the default behavior, which is to
determine the current image for each call.

<h5 id="JS9.LookupImage">Lookup an image by id</h5>
<p>
<code class="api">im = JS9.LookupImage(id)</code>
<p>
where:
<ul>
<li><b>id</b>: image id
</ul>
<p>
returns:
<ul>
<li><b>im</b>: image handle
</ul>
<p>
The <b>JS9.LookupImage()</b> routine takes a string id as input and
returns the image handle of the image having that id (or null). The id
is the same as is found in the <b>File</b> menu list of displayed images.
This routine is similar to the standard
<a href="#JS9.GetImage"><b>JS9.GetImage()</b></a>
routine, but returns an image by name, regardless of whether it is
currently being displayed.

<p>
You can use this routine, for example, so close an image that is not
currently being displayed. If two images, foo1.fits and foo2.fits, are
loaded into a JS9 display, and foo1.fits is currently being displayed,
you can close foo2.fits this way:
<pre>
    var im = JS9.LookupImage("foo2.fits");
    if( im ){
        JS9.CloseImage({display: im});
    }
</pre>

<h5 id="JS9.GetImageData">Get image data and auxiliary info for the specified image</h5>
<p>
<code class="api">imdata = JS9.GetImageData(dflag)</code>
<p>
where:
<ul>
<li><b>dflag</b>: specifies whether the data should also be returned
</ul>
<p>
returns:
<ul>
<li><b>imdata</b>: image data object
</ul>
<p>
The image data object contains the following information:
<ul>
<li><b>id</b>: the id of the file that was loaded into JS9
<li><b>file</b>: the file or URL that was loaded into JS9
<li><b>fits</b>: the FITS file associated with this image
<li><b>source</b>: "fits" if a FITS file was downloaded, "fits2png" if a representation file was retrieved
<li><b>imtab</b>: "image" for FITS images and png files, "table" for FITS binary tables
<li><b>width</b>: x dimension of image
<li><b>height</b>: y dimension of image
<li><b>fwidth</b>: x dimension of image or fully binned table in original file
<li><b>fheight</b>: y dimension of image or fully binned table in original file
<li><b>dwidth</b>: width of JS9 display element
<li><b>dheight</b>: height of JS9 display element
<li><b>bitpix</b>: FITS bits/pixel of each image element (8 for unsigned char, 16, 32 for signed integer, -32 or -64 for float)
<li><b>bin</b>: current binning factor
<li><b>header</b>: JavaScript object containing FITS header values
<li><b>hdus</b>: JavaScript array containing objects that describe the FITS HDU structure (FITS files only)
<li><b>data</b>: buffer containing raw data values
</ul>
This call can return raw data for subsequent use in local analysis
tasks. The format of the returned data depends on the exact value
of <b>dflag</b>. If <b>dflag</b> is the boolean value true, an HTML5
typed array is returned. In JavaScript, typed arrays are more
efficient than ordinary JavaScript arrays, and, in this case, the
returned data is actually just reference to the real JS9 image data
(so be careful about changing values).
<p>
If <b>dflag</b> is the string "array", a JavaScript array is returned.
This is not a reference to the real data and will utilize
additional memory, but the values can be manipulated safely.
<p>
If <b>dflag</b> is the string "base64", a base64-encoded string is
returned.  Oddly, this seems to be the fastest method of transferring
data to via socket.io an external process such as Python, and, in fact, 
is the method used by the pyjs9.py interface. (The "array" method also can 
be used, but seems to be slower.)

<p>
The <b>file</b> value can be a FITS file or a representation PNG file. The
<b>fits</b> value will be the path of the FITS file associated with
this image. For a presentation PNG file, the path generally will be
relative to the JS9 install directory. For a normal FITS file, the path
usually is an absolute path to the FITS file.

<p>
The <b>header</b> object contains FITS header keywords. Note that all
HISTORY and COMMENT keywords have two underscores and a numeric value
appended, in order to make them unique within the object.

<p>
If you are calling <b>JS9.GetImageData()</b> from an external process (via
the msg protocol), you almost certainly want to set <b>dflag</b> to "array". 
Doing so will serialize the data as an array instead of as an object, saving
a considerable amount of transfer data.
<p>
Given a FITS-standard 1-indexed image pixel x,y, you can find the data value 
at that location using:
<pre>
    val = obj.data[Math.floor(y-1) * obj.width + Math.floor(x-1)];
</pre>
Note the need to integerize the x and y values: JavaScript arrays are
objects and so floating point array indices do not get truncated
automatically as in C. They will return null values.

<h5 id="JS9.GetDisplayData">Get image data for all images loaded into the specified display</h5>
<p>
<code class="api">imarr = JS9.GetDisplayData()</code>
<p>
returns:
<ul>
<li><b>imdataArr</b>: array of image data objects
</ul>
<p>
The <b>JS9.GetDisplayData()</b> routine returns an array of image data
objects, one for each images loaded into the specified display.
That is, it returns the same type of information as
<a href="#JS9.GetImageData"><b>JS9.GetImageData()</b></a>,
but does so for each image associated
with the display, not just the current image.

<h5 id="JS9.DisplayImage">Display an image</h5>
<p>
<code class="api">JS9.DisplayImage(step)</code>
<p>
where:
<ul>
<li><b>step</b>: starting step to take when displaying the image
</ul>
The display steps are: "colors" (remake color data when cmap has changed),
"scaled" (rescale data values), "primary" (convert scaled data values
to color values), and "display" (write color values to the web page).
<p>
The default step is "primary", which displays the image without recalculating
color data, scaled data, etc. This generally is what you want, unless you have
explicitly changed parameter(s) used in a prior step.

<h5 id="JS9.RefreshImage">Re-read the image data and re-display</h5>
<p>
<code class="api">JS9.RefreshImage(input, opts)</code>
<p>
where:
<ul>
<li><b>input</b>: object, javascript array, typed array, FITS blob, or string
<li><b>opts</b>: optional options or function to call when refresh is complete
</ul>
This routine can be used, for example, in laboratory settings where
data is being gathered in real-time and the JS9 display needs to be
refreshed periodically. The first <b>input</b> argument can be one of
the following:
<ul>
<li> a text string specifying a new URL to retrieve
<li> a javascript array containing raw data
<li> a typed array containing raw data
<li> a blob containing a FITS file
<li> an object containing a required <b>image</b> property and any of the
following optional properties: 
<ul>
<li><b>naxis</b>: number of axes in the image
<li><b>axis</b>: array of image dimensions for each axis or ...
<li><b>naxis[n]</b>: image dimensions of each axis (naxis1, naxis2, ...)
<li><b>bitpix</b>: FITS bitpix value
<li><b>head</b>: object containing header keywords as properties
<li><b>dmin</b>: data min (optional)
<li><b>dmax</b>: data max (optional)
</ul>
</ul>
A text string passed to the <b>input</b> argument is assumed to be a
URL (or local file pathname) to retrieve and utilize when refreshing
the data. This option is used, for example, where an external program
rewrites the image file, and the new data are then used to refresh the
display. Note that the specified file becomes the current image file and
will be used for subsequent server-based analysis request as well as
refreshImage() calls with a null input argument (see next paragraph).
<p>
If the <b>input</b> argument is null, the current image file is
reloaded, assuming its file path (or URL) is known. For security
reasons, browsers do not expose the path of files loaded via <i>Drag
and Drop</i> or <i>Open Local File</i>. On a local web page, you can
safely use the <b>File -> set this image file's path</b> menu option
to enter the image path here for subsequent reloading (or analysis).
<p>
When passing an object as <b>input</b>, the required <b>image</b>
property containing the image data can be a javascript array or a
typed data array. It also can contain a base64-encoded string
containing an array. This latter can be useful when calling
JS9.RefreshImage() via HTTP.
<p>
Ordinarily, when refreshing an image, there is no need to specify the
optional axis, bitpix, or header properties.  But note that you actually
can change these values on the fly, and JS9 will process the new data
correctly.  Also, if you do not pass <b>dmin</b> or <b>dmax</b>, they
will be calculated by JS9.
<p>
Note that you can pass a <b>blob</b> containing a complete FITS file to this
routine. The blob will be passed to the underlying FITS-handler before
being displayed. Thus, processing time is slightly greater than if you just
pass the image data directly.
<p>
The second optional argument can be an object containing the following:
<ul>
<li><b>onrefresh</b>: function to perform when refresh is complete
</ul>
For backwards compatibility, the onrefresh function can be specified directly
by this argument. In both cases, the image handle is passed to the function:
<pre>
    # preferred method
    JS9.RefreshImage(blob, {onrefresh: xrefresh});
    # for backwards compatibility
    JS9.RefreshImage(blob, xrefresh);
    # both call this function
    function xrefresh(im){ ... };
</pre>

<p>
The main difference between <b>JS9.RefreshImage()</b> and
<a href="#JS9.Load"><b>JS9.Load()</b></a>
is that the former updates the data into an existing image,
while the latter adds a completely new image to the display.

<h5 id="JS9.DisplaySection">Extract and display a section of a FITS file</h5>
<p>
<code class="api">JS9.DisplaySection(opts)</code>
<p>
where:
<ul>
<li><b>opts</b>: object containing section options or "full"
</ul>
This routine allows you to extract and display a section of FITS file.
If the first argument is the text string "full", the full image is
displayed (assuming there is sufficient memory available).  Otherwise
the opts object contains properties specifying how to generate and
display the section:
<ul>
<li><b>xcen</b>: x center of the section in file (physical) coords
<li><b>ycen</b>: y center of the section in file (physical) coords
<li><b>xdim</b>: x dimension of section to extract before binning
<li><b>ydim</b>: y dimension of section to extract before binning
<li><b>bin</b>: integer bin factor or bin directive string
<li><b>filter</b>: for tables, row/event filter to apply when extracting section
<li><b>separate</b>: if true, display as a separate image (default is to update the current image)
<li><b>ondisplaysection</b>: function to perform after section is displayed
</ul>
The bin directives are:
<ul>
<li><b>x[n]|X[n]|*[n]</b>: multiply the current bin by n (e.g. "x2")
<li><b>/[n]</b>: divide the current bin by n (e.g. "/2")
<li><b>+[n]</b>: add n to the current bin (e.g. "+2")
<li><b>-[n]</b>: subtract n from the current bin (e.g. "-2")
<li><b>in|In</b>: multiply the current bin by 2
<li><b>out|Out</b>: divide the current bin by 2
</ul>

<p>
All properties are optional: if a property is not specified,
the routine will use
<del>
the center of the file, with dimensions and binning
specified by JS9.globalOpts.table and JS9.globalOpts.image objects.
</del>
the image's current settings. This allows you to set up the section once,
and then repeatedly change a property such as the center or filter,
without having to specify the other properties.

<p>
For example, if an image has dimensions 4096 x 4096, then specifying:
<ul>
<li> center: 1024, 1024
<li> dimensions: 1024, 1024
<li> bin: 2
</ul>
will bin the upper left 1024 x 1024 section of the image by 2 to
produce a 512 x 512 image. Subsequent calls to change the center
values will pan the image using the same bin factor and dimension.

<p>
Note that setting xcen,ycen to 0,0 will specify the file center. 

<p>
Table filtering allows you  to select rows from an FITS binary table
(e.g., an X-ray event list) by checking each row against an expression
involving the columns in the table. When a table is filtered, only
valid rows satisfying these expressions are used to make the image.

<p>
A filter expression consists of an arithmetic or logical operation
involving one or more column values from a table. Columns can be
compared to other columns or to numeric constants. Standard JavaScript
math functions can be applied to columns. JavaScript (or C) semantics
are used when constructing expressions, with the usual precedence and
associativity rules holding sway:
<pre>
  Operator                                Associativity
  --------                                -------------
  ()                                      left to right
  !  (bitwise not) - (unary minus)        right to left
  *  /                                    left to right
  +  -                                    left to right
  &lt; &lt;= &gt; &gt;=                               left to right
  == !=                                   left to right
  &  (bitwise and)                        left to right
  ^  (bitwise exclusive or)               left to right
  |  (bitwise inclusive or)               left to right
  && (logical and)                        left to right
  || (logical or)                         left to right
  =                                       right to left
</pre>
For example, if energy and pha are columns in a table, then the
following are valid expressions:
<pre>
  pha &gt; 1
  energy == pha
  pha &gt; 1 && energy &le; 2
  max(pha,energy) &ge; 2.5
</pre>

<p>
NB: JS9 uses cfitsio by default (you can, but should not, use the
deprecated fitsy.js), and therefore follows cfitsio filtering
conventions, which are documented
<a href="https://heasarc.gsfc.nasa.gov/docs/software/fitsio/c/c_user/node97.html">here</a>.

<h5 id="JS9.DisplayExtension">Display an extension from a multi-extension FITS file</h5>
<p>
<code class="api">JS9.DisplayExtension(extid, opts)</code>
<p>
where:
<ul>
<li><b>extid</b>: HDU extension number or the HDU's EXTNAME value
<li><b>opts</b>: object containing options
</ul>
This routine allows you to display images and even binary tables from
a multi-extension FITS file. (See, for example,
<a href=" http://fits.gsfc.nasa.gov/fits_primer.html">the FITS Primer</a>
for information about HDUs and multi-extension FITS).

<h5 id="JS9.DisplaySlice">Display a slice of a FITS data cube</h5>
<p>
<code class="api">JS9.DisplaySlice(slice, opts)</code>
<p>
where:
<ul>
<li><b>slice</b>: slice description or slice number
<li><b>opts</b>: object containing options
</ul>
This routine allows you to display a 2D slice of a 3D or 4D FITS data
cube, i.e.  a FITS image containing 3 or 4 axes.

<p>
The <b>slice</b> parameter can either be the numeric value of the
slice in the third (or fourth) image dimension (starting
with <b>1</b>) or it can be a slice description string: a combination
of asterisks and a numeric value defines the slice axis. Thus, for
example, in a 1024 x 1024 x 16 cube, you can display the sixth slice
along the third axis in one of two ways:
<pre>
  JS9.DisplaySlice(6);
</pre>
or:
<pre>
  JS9.DisplaySlice("*,*,6");
</pre>
If the image was organized as 16 x 1024 x 1024, you would use the
string description:
<pre>
  JS9.DisplaySlice("6,*,*");
</pre>
<p>
By default, the new slice replaces the data in the currently displayed
image. You can display the slice as a separate image by supplying
an <b>opts</b> object with its <b>separate</b> property set to <b>true</b>.
For example:
<pre>
  JS9.DisplaySlice("6,*,*", {separate: true});
</pre>
will display the sixth slice of the first image dimension separately
from the original file, allowing blinking, image blending, etc. between
the two "files".  Note that the new id and filename are adjusted to be
the original file's values with the cfitsio image section <b>[6:6,*,*]</b>
appended.

<h5 id="JS9.BlendImage">Blend the image in an image stack using W3C composite/blend modes</h5>
<p>
<code class="api">JS9.BlendImage(blendMode, opacity)</code>
<p>
Calling sequences:
<pre>
    JS9.BlendImage()                   # return current blend params
    JS9.BlendImage(true||false)        # turn on/off blending
    JS9.BlendImage(mode, opacity)      # set blend mode and/or opacity
</pre>
<p>
where:
<ul>
<li><b>mode</b>: one of the W3C bend modes
<li><b>opacity</b>: the opacity of the blended image (percent from 0 to 1)
</ul>
Image processing programs such as Adobe Photoshop and Gimp allow you to blend
a stack of images together by mixing the RGB colors. The W3C has defined a
number of composite and blending modes which have been implemented by Firefox, Chrome, and Safari (what about IE?):
<ul>
<li>normal
<li>multiply
<li>screen
<li>overlay
<li>darken
<li>lighten
<li>color-dodge
<li>color-burn
<li>hard-light
<li>soft-light
<li>difference
<li>exclusion
<li>hue
<li>saturation
<li>color
<li>luminosity
</ul>
In addition, the following Porter-Duff compositing modes are available
(though its unclear how useful they are in JS9 image processing):
<ul>
<li>clear
<li>copy
<li>source-over
<li>destination-over
<li>source-in
<li>destination-in
<li>source-out
<li>destination-out
<li>source-atop
<li>destination-atop
<li>xor
<li>lighter
</ul>
Blending and compositing modes are described in detail in this <a href="https://www.w3.org/TR/compositing-1/">W3C candidate recommendation</a>
and in this <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Compositing">Mozilla document</a>.

<p>
JS9 allows you to use these modes to blend images together. If you load two
images of the same object into JS9, you can use the
<a href="#JS9.ReprojectData"><b>JS9.ReprojectData()</b></a>
routine to align them by WCS. You then can blend one image into the other by
specifying a blend mode and an optional opacity. For example, if chandra.fits
and spitzer.fits are two aligned images of the same object, and chandra.fits is
currently being displayed, you can blend spitzer into chandra using
the "screen" blend and opacity 0.9 mode this way:
<pre>
    JS9.BlendImage("screen", 0.9);
</pre>
After the spitzer image is blended, both images will be displayed as
part of the chandra.fits display. However, changing the colormap,
scale, contrast, or bias will only affect the current chandra image,
not the blended spitzer part.  In this way, you can continue to
manipulate the current image and the image blending will update automatically.

<p>
Also note that the spitzer image is still available separately for
display and manipulation. You can switch to displaying spitzer and
change colormap, scale, bias, contrast, etc. But since the images are
now blended, changes to spitzer will be reflected in the spitzer part
of the blended chandra display. Thus, if you change the colormap on
the display of spitzer, and change back to chandra, the blended
chandra image will utilize the new colormap.

<p>
This linkage is maintained during zoom and pan operations. If you
display the blended chandra image and then zoom or pan it, both images
will be updated correctly to maintain alignment. But note that this
means when you go back to the spitzer display, its zoom and/or pan
values will have been updated. In this way, the spitzer image always
is correctly linked to the blended version.

The <b>JS9.BlendImage()</b> call accepts a variable number of
arguments to perform a variety of functions:
<ul>
<li>JS9.BlendImage() returns an object containing the following properties:
<ul>
<li>active: boolean specifying whether this image is to be blended
<li>mode: string specifying the blend mode
<li>opacity: opacity value (0 to 1)
</ul>
<li>JS9.BlendImage() returns a blend object for the current image
<li>JS9.BlendImage(true||false) turns on/off blending of
<li>JS9.BlendImage(blend, opacity) set or modify the blend mode and/or opacity
</ul>
Other actions will be added as we gain experience with blending operations

<h5 id="JS9.BlendDisplay">Set the global image blend more for the specified display</h5>
<p>
<code class="api">mode = JS9.BlendDisplay(true|false)</code>
<p>
returns:
<ul>
<li><b>mode</b>: current blend mode
</ul>
This routine will turn on/off the global image blend mode for the specified
display. If no argument is specified, it returns the current blend mode.

<h5 id="JS9.CloseImage">Clear the image from the display and mark resources for release</h5>
<p>
<code class="api">JS9.CloseImage()</code>
<p>
Each loaded image claims a non-trivial amount of memory from a finite
amount of browser heap space. For example, the default 32-bit version
of Google Chrome has a memory limit of approximately 500Mb. If you are
finished viewing an image, closing it tells the browser that the
image's memory can be freed. In principle, this is can help reduce
overall memory usage as successive images are loaded and
discarded. Note, however, that closing an image only provides a hint
to the browser, since this sort of garbage collection is not directly
accessible to JavaScript programming.
<p>
Some day, all browsers will support full 64-bit addressing and this problem will
go away ...

<h5 id="JS9.GetColormap">Get the image colormap</h5>
<p>
<code class="api">cmap = JS9.GetColormap()</code>
<p>
returns:
<ul>
<li><b>cmap</b>: object containing colormap information
</ul>
The returned cmap object will contain the following properties:
<ul>
<li><b>colormap</b>: colormap name
<li><b>contrast</b>: contrast value (range: 0 to 10)
<li><b>bias</b>: bias value (range 0 to 1)
</ul>

<h5 id="JS9.SetColormap">Set the image colormap</h5>
<p>
<code class="api">JS9.SetColormap(colormap, [contrast, bias])</code>
<p>
where:
<ul>
<li><b>colormap</b>: colormap name
<li><b>contrast</b>: contrast value (range: 0 to 10)
<li><b>bias</b>: bias value (range 0 to 1)
</ul>
Set the current colormap, contrast/bias, or both. This call takes one
(colormap), two (contrast, bias) or three (colormap, contrast, bias)
arguments.

<h5 id="JS9.SaveColormap">Save current colormap definition</h5>
<p>
<code class="api">JS9.SaveColormap(filename)</code>
<p>
where:
<ul>
<li><b>filename</b>: output file name
</ul>
Save the current colormap definition for displayed image as a json
file. If filename is not specified, the file will be saved as "js9.cmap".
This is useful if you want to edit the current definition to make a new
colormap.

<p>
Don't forget that the file is saved by the browser, in whatever location
you have set up for downloads.
</p>

<h5 id="JS9.AddColormap">Add a colormap to JS9</h5>
<p>
<code class="api">JS9.AddColormap(name, aa|rr,gg,bb|obj|json)</code>
<p>
where:
<ul>
<li><b>name</b>: colormap name
<li><b>aa</b>: an array containing RGB color triplets
<li><b>rr,gg,bb</b>: 3 arrays of vertices specifying color changes
<li><b>obj</b>: object containing one of the two colormap definition formats
<li><b>json</b>: json string containing one of the colormap definition formats
</ul>
You can add new colormaps to JS9 using one of two formats. The first
is an array of RGB triplets (i.e. an array of 3-D arrays), where each
triplet defines a color. The elements of the colormap are divided
evenly between these 3-D triplets.  For example, the <b>i8</b>
colormap is defined as:
<pre>
    JS9.AddColormap("i8", [[0,0,0], [0,1,0], [0,0,1], [0,1,1], [1,0,0], [1,1,0], [1,0,1], [1,1,1]]));
</pre>
Here, the colormap is divided into 8 sections having the following
colors: black, green, blue, cyan (green + blue), red, yellow (red +
green), purple (red + blue), and white. A colormap such as <b>sls</b>
also utilizes an array of RGB triplets, but it has 200 entries,
leading to much more gradual transitions between colors.
<p>
The second colormap format consists three arrays of vertices defining
the change in intensity of red, green, and blue, respectively. For
each of these three color triplets, the first coordinate of each
vertex is the x-distance along the colormap axis (scaled from 0 to 1)
and the second coordinate is the y-intensity of the color.  Colors are
interpolated between the vertices.  For example, consider the following:
<pre>
    JS9.AddColormap("red", [[0,0],[1,1]], [[0,0], [0,0]], [[0,0],[0,0]]);
    JS9.AddColormap("blue", [[0,0],[0,0]], [[0,0], [0,0]], [[0,0],[1,1]]);
    JS9.AddColormap("purple", [[0,0],[1,1]], [[0,0], [0,0]], [[0,0],[1,1]]);
</pre>
In the red (blue) colormap, the red (blue) array contains two
vertices, whose color ranges from no intensity (0) to full intensity
(1) over the whole range of the colormap (0 to 1). The same holds true
for the purple colormap, except that both red and blue change from zero
to full intensity.
<p>
For a more complicated example, consider the <b>a</b> colormap, which is
defined as:
<pre>
    JS9.AddColormap("a",
      [[0,0], [0.25,0], [0.5,1], [1,1]],
      [[0,0], [0.25,1], [0.5,0], [0.77,0], [1,1]],
      [[0,0], [0.125,0], [0.5, 1], [0.64,0.5], [0.77, 0], [1,0]]);
</pre>
Here we see that red is absent for the first quarter of the colormap,
then gradually increases to full intensity by the half mark, after
which it stays at full intensity to the end. Green ramps up to full
intensity in the first quarter, then drops to zero by the half and
stays that way until a bit more than three-quarters along, after which
it gradually increases again. Blue starts off at no intensity for an
eighth, then gradually increases to full intensity by the half-way
mark, decreasing gradually to zero by the three-quarter mark. The
result is that you see, for example, green at the beginning and yellow
(red + green) at the end, with some purple (red + blue) in the middle
of the colormap.
<p>
As a convenience, you also can pass an object or json string containing the
colormap definition:
<pre>
    # RGB color triplets for the I8 colormap in a "colors" property
    {"name":"i8","colors":[[0,0,0],[0,1,0],[0,0,1],[0,1,1],[1,0,0],[1,1,0],[1,0,1],[1,1,1]]}

    # all 3 vertex arrays for the purple colormap in one "vertices" property
    {"name":"purple","vertices":[[[0,0],[1,1]],[[0,0],[0,0]],[[0,0],[1,1]]]}
</pre>
<p>
Finally, note that <b>JS9.AddColormap()</b> adds its new colormap to
all JS9 displays on the given page.
</p>

<h5 id="JS9.LoadColormap">Load a colormap file into JS9</h5>
<p>
<code class="api">JS9.LoadColormap(filename)</code>
<p>
where:
<ul>
<li><b>filename</b>: input file name or URL
</ul>
Load the specified colormap file into the web page. The filename,
which must be specified, can be a local file (with absolute path or a
path relative to the displayed web page) or a URL. It should contain a
JSON representation of a colormap, either in RGB color format or in
vertex format (see
<a href="#JS9.AddColormap"><b>JS9.AddColormap()</b></a>
above):
<pre>
    # RGB color format
    {
      "name": "purplish",
      "colors": [
	[0.196, 0.196, 0.196],
	[0.475, 0, 0.608],
	[0, 0, 0.785],
	[0.373, 0.655, 0.925],
	[0, 0.596, 0],
	[0, 0.965, 0],
	[1, 1, 0],
	[1, 0.694, 0],
	[1, 0, 0]
      ]
    }

    # vertex format
    {
      "name": "aips0",
      "vertices": [
	[
	    [0.203, 0],
	    [0.236, 0.245],
	    [0.282, 0.5],
	    [0.342, 0.706],
	    [0.411, 0.882],
	    [0.497, 1]
	],
	[
	    [0.394, 0],
	    [0.411, 0.196],
	    [0.464, 0.48],
	    [0.526, 0.696],
	    [0.593, 0.882],
	    [0.673, 1],
	    [0.94, 1],
	    [0.94, 0]
	],
	[
	    [0.091, 0],
	    [0.091, 0.373],
	    [0.262, 1],
	    [0.94, 1],
	    [0.94, 0]
	]
      ]
    }
</pre>

<p>
As with
<a href="#JS9.AddColormap"><b>JS9.AddColormap()</b></a>,
the new colormap will be available in all displays.
</p>

<h5 id="JS9.GetRGBMode">Get RGB Mode</h5>
<p>
<code class="api">JS9.GetRGBMode()</code>
<p>
returns:
<ul>
<li><b>obj</b>: object containing RGB mode information
</ul>
The returned object will contain the following properties:
<ul>
<li><b>active</b>: boolean specifying whether RGB mode is active
<li><b>rid</b>: image id of "red" image
<li><b>gid</b>: image id of "green" image
<li><b>bid</b>: image id of "blue" image
</ul>

<h5 id="JS9.SetRGBMode">Set RGB Mode</h5>
<p>
<code class="api">JS9.SetRGBMode(mode, [imobj])</code>
<p>
where:
<ul>
<li><b>mode</b>: boolean true to activate RGB mode, false to disable
<li><b>imobj</b>: optional object specifying three images to set to the
"red", "green", and "blue" colormaps
</ul>
In RGB mode, three images assigned the "red", "green", and "blue"
colormaps are displayed as a single image. The RGB color of each
displayed pixel is a combination of the "red", "green", and "blue"
pixel value taken from the appropriate image. Note that all three
images are not required: you can display an RGB image using two of
the three colors simply by not assigning the third colormap.

<p>
The <b>JS9.SetRGBMode()</b> call turns on or off RGB mode. The
boolean <b>mode</b> argument specifies whether to activate or
de-activate RGB mode. The optional <b>imobj</b> object specifies
(already-loaded) images to assign to the three colormaps:
<ul>
<li><b>rid</b>: image id (or handle) to set to the "red" colormap
<li><b>gid</b>: image id (or handle) to set to the "green" colormap
<li><b>bid</b>: image id (or handle) to set to the "blue" colormap
</ul>
If <b>imobj</b> is not specified, it is assumed that images have been
assigned the "red", "green", and "blue" colormaps by another means.
(Once again, it is not necessary to assign all three colormaps.)
<p>
If no arguments are specified, the current RGB mode is toggled;

<h5 id="JS9.GetScale">Get the image scale</h5>
<p>
<code class="api">scale = JS9.GetScale()</code>
<p>
returns:
<ul>
<li><b>scale</b>: object containing scale information
</ul>
The returned scale object will contain the following properties:
<ul>
<li><b>scale</b>: scale name
<li><b>scalemin</b>: min value for scaling
<li><b>scalemax</b>: max value for scaling
</ul>

<h5 id="JS9.SetScale">Set the image scale</h5>
<p>
<code class="api">JS9.SetScale(scale, smin, smax)</code>
<p>
where:
<ul>
<li><b>scale</b>: scale name, "zscale", "zmax", or "dataminmax"
<li><b>smin</b>: scale min value
<li><b>smax</b>: scale max value
</ul>
Set the current scale, min/max, or both. This call takes one
(scale), two (smin, max) or three (scale, smin, smax) arguments. (If "zscale"
or "zmax" is specified, any supplied smin and smax values are ignored.)

<h5 id="JS9.GetZoom">Get the image zoom factor</h5>
<p>
<code class="api">zoom = JS9.GetZoom()</code>
<p>
returns:
<ul>
<li><b>zoom</b>: floating point zoom factor
</ul>
Get the zoom factor.

<h5 id="JS9.SetZoom">Set the image zoom factor</h5>
<p>
<code class="api">JS9.SetZoom(zoom)</code>
<p>
where:
<ul>
<li><b>zoom</b>: floating or integer zoom factor or zoom directive string
</ul>
The zoom directives are:
<ul>
<li><b>x[n]|X[n]|*[n]</b>: multiply the current zoom by n (e.g. "x2")
<li><b>/[n]</b>: divide the current zoom by n (e.g. "/2")
<li><b>in|In</b>: multiply the current zoom by 2
<li><b>out|Out</b>: divide the current zoom by 2
<li><b>toFit|ToFit</b>: zoom to fit image in display
</ul>

<h5 id="JS9.GetPan">Get the image pan position</h5>
<p>
<code class="api">ipos = JS9.GetPan()</code>
<p>
returns:
<ul>
<li><b>ipos</b>: object containing image information for pan
</ul>
The returned ipos object will contain the following properties:
<ul>
<li><b>x</b>: x image coordinate of center
<li><b>y</b>: y image coordinate of center
</ul>

<h5 id="JS9.SetPan">Set the image pan position</h5>
<p>
<code class="api">JS9.SetPan(x, y)</code>
<p>
where:
<ul>
<li><b>x</b>: x image coordinate (or object containing x and y properties)
<li><b>y</b>: y image coordinate
</ul>

<p>
Set the current pan position using image coordinates. Note that you can use
<a href="#JS9.WCSToPix"><b>JS9.WCSToPix()</b></a>
and
<a href="#JS9.PixToWCS"><b>JS9.PixToWCS()</b></a>
to convert between image and WCS coordinates.
</p>
An object containing x and y properties can also be supplied.

<h5 id="JS9.GetParam">Get an image parameter value</h5>
<p>
<code class="api">val = JS9.GetParam(param)</code>
<p>
where:
<ul>
<li><b>param</b>: name of the parameter
</ul>
<p>
returns:
<ul>
<li><b>val</b>: value of the parameter
</ul>

<p>
Return the value of an image parameter. The available parameters are listed
below in the
<a href="#JS9.SetParam"><b>SetParam()</b></a>
section.
</p>

<h5 id="JS9.SetParam">Set an image parameter value</h5>
<p>
<code class="api">ovalue = JS9.SetParam(param, value)</code>
<p>
where:
<ul>
<li><b>param</b>: name of the parameter
<li><b>val</b>: new value of the parameter
</ul>
<p>
returns:
<ul>
<li><b>ovalue</b>: the previous value of the parameter
</ul>
A number of miscellaneous image parameters are copied from the
JS9.imageOpts object to each image when it is first loaded. You can
use the <b>JS9.SetParam()</b> routine to modify these values
subsequently. The available parameters and their current default
values are listed below:
<ul>
<li><b>exp</b>: 1000, default exp value for scaling
<li><b>listonchange</b>: false, list regions after a region change?
<li><b>opacity</b>: 1.0, image display opacity, between 0 and 1
<li><b>nancolor</b>: "#000000", 6-digit #hex color for NaN values
<li><b>valpos</b>: true, display value/position?
<li><b>wcsalign</b>: true, align image using wcs after reproj?
<li><b>xeqonchange</b>: true, xeq an onchange callback after a region change?
<li><b>zscalecontrast</b>: 0.25, default zscale value from ds9
<li><b>zscalesamples</b>: 600,	default zscale value from ds9
<li><b>zscaleline</b>: 120, default zscale value from ds9
</ul>
The routine returns the previous value of the parameter, which can
be useful when temporarily turning off a function. For example:
<pre>
    oval = JS9.SetParam("xeqonchange", false);
    .... processing ...
    JS9.SetParam("xeqonchange", oval);
</pre>
will temporarily disable execution of the previously defined regions
onload callback, resetting it to the old value after processing
is complete.

<h5 id="JS9.EventToDisplayPos">Get the display coordinates from an event</h5>
<p>
<code class="api">dpos = JS9.EventToDisplayPos(evt)</code>
<p>
where:
<ul>
<li><b>evt</b>: a JavaScript or jQuery event
</ul>
returns:
<ul>
<li><b>dpos</b>: display position object containing 0-indexed x and y display
coordinate values
</ul>
If you define your own event callbacks, you can use this routine to convert
the event position to a display position, which can then be used to get the
image position (see below).

<h5 id="JS9.DIsplayToImagePos">Get the image coordinates from the display coordinates</h5>
<p>
<code class="api">ipos = JS9.DisplayToImagePos(dpos)</code>
<p>
where:
<ul>
<li><b>dpos</b>: display position object containing 0-indexed x and y display
coordinate values
</ul>
returns:
<ul>
<li><b>ipos</b>: image position object containing 1-indexed x and y image
coordinate values
</ul>
Note that image coordinates are one-indexed, as per FITS conventions, while
display coordinate are 0-indexed.

<h5 id="JS9.ImageToDisplayPos">Get the display coordinates from the image coordinates</h5>
<p>
<code class="api">dpos = JS9.ImageToDisplayPos(ipos)</code>
<p>
where:
<ul>
<li><b>ipos</b>: image position object containing 1-indexed x and y image
coordinate values
</ul>
returns:
<ul>
<li><b>dpos</b>: display position object containing 0-indexed x and y display
coordinate values
</ul>
Get display (screen) coordinates from image coordinates.  Note that
image coordinates are one-indexed, as per FITS conventions, while
display coordinate are 0-indexed.

<h5 id="JS9.LogicalToImagePos">Get the image coordinates from the logical coordinates</h5>
<p>
<code class="api">ipos = JS9.LogicalToImagePos(lpos, lcs)</code>
<p>
where:
<ul>
<li><b>lpos</b>: logical position object containing 1-indexed x and y logical
coordinate values
</ul>
returns:
<ul>
<li><b>ipos</b>: image position object containing 1-indexed x and y image
coordinate values
</ul>
Logical coordinate systems include: "physical" (defined by LTM/LTV keywords in a
FITS header), "detector" (DTM/DTV keywords), and "amplifier" (ATM/ATV keywords).
Physical coordinates are the most common. In the world of X-ray astronomy, they
refer to the "zoom 1" coordinates of the data file.

<p>
This routine will convert from logical to image coordinates. By default, the
current logical coordinate system is used. You can specify a different logical
coordinate system (assuming the appropriate keywords have been defined).

<h5 id="JS9.ImageToLogicalPos">Get the logical coordinates from the image coordinates</h5>
<p>
<code class="api">lpos = JS9.ImageToLogicalPos(ipos, lcs)</code>
<p>
where:
<ul>
<li><b>ipos</b>: image position object containing 1-indexed x and y image
coordinate values
</ul>
returns:
<ul>
<li><b>lpos</b>: logical position object containing 1-indexed x and y logical
coordinate values
</ul>
Logical coordinate systems include: "physical" (defined by LTM/LTV keywords in a
FITS header), "detector" (DTM/DTV keywords), and "amplifier" (ATM/ATV keywords).
Physical coordinates are the most common. In the world of X-ray astronomy, they
refer to the "zoom 1" coordinates of the data file.
<p>
This routine will convert from image to logical coordinates. By default, the
current logical coordinate system is used. You can specify a different logical
coordinate system (assuming the appropriate keywords have been defined).

<h5 id="JS9.GetValPos">Get value/position information</h5>
<p>
<code class="api">valpos = JS9.GetValPos(ipos, display)</code>
<p>
where:
<ul>
<li><b>ipos</b>: image position object containing 1-indexed x and y image coord values
<li><b>display</b>: boolean value specifying whether the info box display should be updated (default is true)
</ul>
returns:
<ul>
<li><b>valpos</b>: value/position object
</ul>
This routine determines the data value at a given image position
and returns an object containing the following information:
<ul>
<li><b>ix</b>: image x coordinate
<li><b>iy</b>: image y coordinate
<li><b>isys</b>: image system (i.e. "image")
<li><b>px</b>: physical x coordinate
<li><b>py</b>: physical y coordinate
<li><b>psys</b>: currently selected pixel-based system (i.e. "image"
or "physical") for the above px, py values
<li><b>ra</b>: ra in degrees (if WCS is available)
<li><b>dec</b>: dec in degrees  (if WCS is available)
<li><b>wcssys</b>: wcs system (if WCS is available)
<li><b>val</b>: floating point pixel value
<li><b>val3</b>: pixel value as a string truncated to 3 decimal digits
<li><b>vstr</b>: string containing value and position info
<li><b>id</b>: id of the image
<li><b>file</b>: filename of the image
<li><b>object</b>: object name of the image from the FITS header
</ul>

<h5 id="JS9.SetValPos">Set the value/position display mode</h5>
<p>
<code class="api">JS9.SetValPos(mode)</code>
<p>
where:
<ul>
<li><b>mode</b>: true (show valpos display) or false (hide valpos display)
</ul>
Set the display mode of the value/position display for the specified image.

<h5 id="JS9.GetImageInherit">Get the image inherit mode</h5>
<p>
<code class="api">inherit = JS9.GetImageInherit()</code>
<p>
returns:
<ul>
<li><b>inherit</b>: true if new image inherits params from current image
</ul>
The <b>JS9.GetImageInherit()</b> routine returns a boolean specifying whether
a new image grabs the image params (e.g., colormap, scale, zoom, etc.)
from the currently displayed image. If false, these params are taken
from the default JS9.imageOpts object.

<h5 id="JS9.SetImageInherit">Set the image inherit mode</h5>
<p>
<code class="api">JS9.SetImageInherit(mode)</code>
<p>
where:
<ul>
<li><b>mode</b>: true (inherit params from currently displayed image) or false
</ul>
The <b>JS9.SetImageInherit()</b> routine specifies whether
a new image grabs the image params (e.g., colormap, scale, zoom, etc.)
from the currently displayed image. If false, these params are taken
from the default JS9.imageOpts object.

<h5 id="JS9.GetWCS">Get information about the current WCS</h5>
<p>
<code class="api">wcsobj = JS9.GetWCS()</code>
<p>
returns:
<ul>
<li><b>wcsobj</b>: object containing WCS info
</ul>
<p>
Get information about the current WCS, including:
<ul>
<li><b>version</b>: the WCS version ("default" or the letter "A"-"Z" for an alternate WCS)
<li><b>wcsname</b>: the value of the WCSNAME header parameter associated
with this WCS, if present
<li><b>crot</b>: crot value (i.e., the CROT1 value) from wcs library 
<li><b>crpix[1,2]</b>: crpix values from wcs library
<li><b>crval[1,2]</b>: crval values from wcs library
<li><b>crdelt[1,2]</b>: crdelt values from wcs library
<li><b>crtype[1,2]</b>: crtype values (e.g., "RA" and "Dec") from wcs library
<li><b>ptype</b>: ptype value (e.g., "TAN") from wcs library
<li><b>radecsys</b>: radecsys value (e.g., "ICRS") from the wcs library
</ul>

<h5 id="JS9.SetWCS">Set the current WCS</h5>
<p>
<code class="api">JS9.SetWCS(which)</code>
<p>
where:
<ul>
<li><b>which</b>: WCS name or id
</ul>
Set the current WCS, in cases where alternate WCS's are available. The
alternate WCS convention is described in the standard paper by Greisen
and Callebretta <i>Representations of world coordinates in FITS</i>
(A&A 395, 10611075 (2002)). If a FITS file contains alternate WCS
info, you can switch to an alternate using this routine or using
the <b>File->alternate wcs</b> menu option.
<p>
The <b>which</b> argument can be one of the following:
<ul>
<li><b>default</b>: the default WCS from the original file
<li><b>[version]</b>: the version letter of the alternate WCS, i.e. <b>A-Z</b>
<li><b>[wcsname]</b>: the value of the WCSNAME header parameter associated
with this WCS, if present
</ul>
If no argument is supplied, the default WCS is set up.

<h5 id="JS9.GetWCSUnits">Get the current WCS units</h5>
<p>
<code class="api">unitsstr = JS9.GetWCSUnits()</code>
<p>
returns:
<ul>
<li><b>unitstr</b>: "pixels", "degrees" or "sexagesimal"
</ul>
Get the current WCS units.

<h5 id="JS9>SetWCSUnits">Set the current WCS units</h5>
<p>
<code class="api">JS9.SetWCSUnits(unitsstr)</code>
<p>
where:
<ul>
<li><b>unitstr</b>: "pixels", "degrees" or "sexagesimal"
</ul>
Set the current WCS units.

<h5 id="JS9.GetWCSSys">Get the current World Coordinate System</h5>
<p>
<code class="api">sysstr = JS9.GetWCSSys()</code>
<p>
returns:
<ul>
<li><b>sysstr</b>: current World Coordinate System ("FK4", "FK5", "ICRS",
"galactic", "ecliptic", "image", or "physical");
</ul>
Get current WCS system.

<h5 id="JS9.SetWCSSys">Set the current World Coordinate System</h5>
<p>
<code class="api">JS9.SetWCSSys(sysstr)</code>
<p>
where:
<ul>
<li><b>sysstr</b>: World Coordinate System ("FK4", "FK5", "ICRS",
"galactic", "ecliptic", "image", or "physical")
</ul>
Set current WCS system. The WCS systems are available only if WCS
information is contained in the FITS header. Also note that "physical"
coordinates are the coordinates tied to the original file. They are
mainly used in X-ray astronomy where individually detected photon
events are binned into an image, possibly using a blocking factor.
For optical images, image and physical coordinate usually are identical.

<h5 id="JS9.PixToWCS">Convert image pixel position to WCS position</h5>
<p>
<code class="api">wcsobj = JS9.PixToWCS(x, y)</code>
<p>
where:
<ul>
<li><b>x</b>: x image coordinate (or object containing x and y properties)
<li><b>y</b>: y image coordinate
</ul>
returns:
<ul>
<li><b>wcsobj</b>: world coordinate system object
</ul>
<p>
The returned wcs object contains the following properties:
<ul>
<li><b>ra</b>: right ascension in floating point degrees
<li><b>dec</b>: declination in floating point degrees 
<li><b>sys</b>: current world coordinate system being used
<li><b>str</b>: string of wcs in current system ("[ra] [dec] [sys]")
</ul>
You can either supply the x and y image coordinates as two numeric
arguments, or supply a single object containing numeric x and y properties.

<h5 id="JS9.WCSToPix">Convert WCS position to image pixel position</h5>
<p>
<code class="api">pixobj = JS9.WCSToPix(ra, dec)</code>
<p>
where:
<ul>
<li><b>ra</b>: right ascension in floating point degrees (or object containing ra and dec properties)
<li><b>dec</b>: declination in floating point degrees 
</ul>
returns:
<ul>
<li><b>pixobj</b>: pixel object
</ul>
The returned pixel object contains the following properties:
<ul>
<li><b>x</b>: x image coordinate
<li><b>y</b>: y image coordinate
<li><b>str</b>: string of pixel values ("[x]" "[y]")
</ul>
You can either supply the RA and Dec as two numeric arguments, or supply a
single object containing numeric ra and dec properties.

<h5 id="JS9.DisplayMessage">Display a text message</h5>
<p>
<code class="api">JS9.DisplayMessage(which, text)</code>
<p>
where:
<ul>
<li><b>which</b>: "info" or "regions"
<li><b>text</b>: text to display
</ul>
The text string is displayed in the "info" area (usually occupied by the
valpos display) or the "region" area (where regions are displayed). The
empty string will clear the previous message.

<h5 id="JS9.RawDataLayer">Create or modify a raw data layer</h5>
<p>
<code class="api">JS9.RawDataLayer(opts, func)</code>
<p>
where:
<ul>
<li><b>opts</b>: layer name or opts object
<li><b>func</b>: function used to create or modify raw data
</ul>
Each image has raw data associated with it, i.e. the underlying
astronomical image pixels that are scaled and displayed using the
chosen scale and colormap. You can manipulate the raw data by creating
a new <b>raw data layer</b> using <b>JS9.RawDataLayer()</b>,
setting
the image pixel values, and then making this layer the current
one. The original raw data (with id "raw0") will be maintained in
separate layer, so you can switch between layers (also using this
routine).

<p>
To create a new raw data layer (or edit an existing layer), call the
<b>JS9.RawDataLayer()</b> with two arguments: layer opts (or layer
name) and a function. The layer opts object can have the following properties:
<ul>
<li><b>rawid</b>: id of new raw data layer (default: "alt")
<li><b>oraw</b>: id of raw data layer to pass to func or "current" (default: "raw0", i.e., the original data)
<li><b>from</b>: descriptive string describing origin of this raw data (def: "func")
</ul>
Alternative, you can pass the id of the raw data layer as a string and
use the defaults for the other properties (which usually is sufficient).

<p>
The pixel modifying function should have the following calling sequence:
<pre>
    func(oraw, nraw, opts)
</pre>
where:
<ul>
<li><b>oraw</b>: the raw data object specified by the <b>from</b> property above (def: original raw data "raw0");
<li><b>nraw</b>: the raw data layer you are modifying
<li><b>opts</b>: the original opts object along with any params you add to it
</ul>
The function should return <b>true</b> is you want to switch to the new layer
and display it, or <b>false</b> to discard the new layer (in case of an error).

<p>
Note that the <b>nraw</b> object will contain the raw data for this
layer, if it already exists. Otherwise, it will contain a copy of
the <b>from</b> data.

<p>
For example, the following routine creates a new "clip" layer and
clips the original raw data at the specified nmax level:
<pre>
    im.rawData({rawid: "clip", nmax: n}, function (oraw, nraw, opts){
        var i, len;
        opts = opts || {};
        if( opts.nmax === undefined ){ opts.nmax = 0; }
        len = nraw.width * nraw.height;
        for(i=0; i&lt;len; i++){
            if( oraw.data[i] &lt; opts.nmax ){
                nraw.data[i] = 0;
            } else {
                nraw.data[i] = oraw.data[i];
            }
        }
        return true;
    });
</pre>
When clipping, the nraw pixel values are taken from the oraw values, so
that you can clip to a value of 100, then clip to a value of 50, and
get the right result. This is different from the following example "add"
layer, which adds a constant value to the existing data:
<pre>
    im.rawData({rawid: "add", val: n}, function (oraw, nraw, opts){
        var i, len;
        opts = opts || {};
        if( opts.val === undefined ){
            opts.val = 1;
        }
        len = nraw.width * nraw.height;
        for(i=0; i&lt;len; i++){
            nraw.data[i] += opts.val;
        }
        return true;
    });
</pre>
Here, the operation is performed on the existing "add" layer each time, so
that the addition is cumulative.

<p>
The oraw and nraw objects contain a subset of the properties returned by
<a href="#JS9.GetImageData"><b>JS9.GetImageData()</b></a>:
<ul>
<li><b>width</b>: x dimension of image
<li><b>height</b>: y dimension of image
<li><b>bitpix</b>: FITS bits/pixel of each image element (8 for unsigned char, 16, 32 for signed integer, -32 or -64 for float)
<li><b>header</b>: JavaScript object containing FITS header values
<li><b>data</b>: buffer containing raw data values
</ul>

<p>
To switch to a layer, call <b>JS9.RawDataLayer()</b>
with a single argument, the layer name:
<pre>
    JS9.RawDataLayer("raw0")   # switch to original data
    JS9.RawDataLayer("clip")   # switch to clipped data
    JS9.RawDataLayer("add")    # switch to add data
</pre>
To get the currently displayed layer, call the routine with no arguments:
<pre>
    JS9.RawDataLayer()         # returns "clip"
</pre>

<h5 id="JS9.GaussBlurData">Gaussian blur of raw data</h5>
<p>
<code class="api">JS9.GaussBlurData(sigma, opts)</code>
<p>
where:
<ul>
<li><b>sigma</b>: sigma of Gaussian function
<li><b>opts</b>: options object
</ul>
This routine creates a new raw data layer called "gaussBlur" in which
the image pixel values are blurred using a Gaussian function with the
specified sigma. The routine uses the fast Gaussian blur algorithm
(approximating a full Gaussian blur with three passes of a box blur)
described <a href="http://blog.ivank.net/fastest-gaussian-blur.html">
here</a>.

<h5 id="JS9.ImarithData">Perform image arithmetic on raw data</h5>
<p>
<code class="api">JS9.ImarithData(op, arg1, opts)</code>
<p>
where:
<ul>
<li><b>op</b>: image operation: "add", "sub", "mul", "div", "min", "max", and "reset"
<li><b>arg1</b>: image handle, image id or numeric value
<li><b>opts</b>: options object
</ul>
The <b>JS9.ImarithData()</b> routine performs basic arithmetic
(addition, subtraction, multiplication, division, minimum, maximum, average)
between the currently displayed image and either another image or a
constant value. The first <b>op</b> argument is a string, as detailed
above. The second <b>arg1</b> argument can be a numeric value or an
image id. In the former case, the constant value is applied to each
pixel in the image. In the latter case, the operation is performed
between the corresponding pixels in the two images. For example:
<pre>
    JS9.ImarithData("max", "foo.fits");
</pre>
will make a new data layer of the currently displayed image, where
each pixel is the larger value from that image and the foo.fits image
(which can be in any display).

<p>
This routine creates a new raw data layer called "imarith" containing
the results of the operation. Successive calls to this routine are
cumulative, so that you can build up a more complex operation from
simple ones. For example:
<pre>
    # foo.fits is displayed in the "myJS9" display
    var myim = JS9.GetImage({display: "myJS9"});
    JS9.ImarithData("max", myim);
    JS9.ImarithData("add", 2.718);
</pre>
will make a new data layer where each pixel is the larger value from
the two images, after which an approximation of the irrational number
e is added to each pixel. 

<p>
The special <b>reset</b> operation deletes the "imarith" raw data
layer, allowing you to start afresh.

<p>
The bitpix value of the new "imarith" layer is chosen as follows:
<ul>
<li> for operations between two images, bitpix the "larger" of the two
images (where float is "larger" than int).
<li> for operations between an image and a constant, bitpix of -32
(single float) is chosen unless the image itself has bitpix of -64, in
which case the double float bitpix is chosen.
</ul>
You can override the choice of bitpix by passing a <b>bitpix</b> property
in the optional opts object.

<p>
Finally, note that the two images must have the same dimensions. We
might be able to remove this restriction in the future, although
it is unclear how one lines up images of different dimensions.

<h5 id="JS9.ShiftData">Shift raw data</h5>
<p>
<code class="api">JS9.ShiftData(x, y, opts)</code>
<p>
where:
<ul>
<li><b>x</b>: number of pixels to shift in the x (width) direction
<li><b>y</b>: number of pixels to shift in the y (height) direction
<li><b>opts</b>: options object
</ul>
This routine creates a new raw data layer called "shift" in which
the pixels are shifted from the original image array by the specified
amount in x and/or y. The results of successive shifts are
cumulative. The routine is used by the Harvard-Smithsonian Center for
Astrophysics MicroObservatory project interactively to align images
that are only slightly offset from one another.

<h5 id="JS9.FilterRGBImage">Apply a filter to the RGB image</h5>
<p>
<code class="api">JS9.FilterRGBImage(filter, args)</code>
<p>
where:
<ul>
<li><b>filter</b>: name of image filter to apply to the RGB data
<li><b>args</b>: filter-specific arguments, where applicable
</ul>
In JS9, you can change the raw data (and hence the displayed image) using
routines such as
<a href="#JS9.GaussBlurData"><b>JS9.GaussBlurData()</b></a>
or the more general
<a href="#JS9.RawDataLayer"><b>JS9.RawDataLayer()</b></a>.
You also can apply image processing
techniques directly to the displayed RGB image without changing the
underlying raw data, using this routine. The web has an overwhelming
amount of information about image processing.  A good technical
article concerning the use of image filters with Javascript and the
HTML5 canvas is available at:
<a href="http://www.html5rocks.com/en/tutorials/canvas/imagefilters/">
http://www.html5rocks.com/en/tutorials/canvas/imagefilters/
</a>

<p>
The <b>JS9.FilterRGBImage()</b> routine supports a number of image
processing routines, which are listed below.  To call one of them
using <b>JS9.FilterRGBImage()</b>, supply the filter name, followed by any
filter-specific arguments, e.g.:
<pre>
    JS9.FilterRGBImage("luminance", {display: "myJS9"});
    JS9.FilterRGBImage("duotone", "g", {display: "myJS9"});
    JS9.FilterRGBImage("convolve", [-1,-1,-1,-1,8,-1,-1,-1,-1]);
</pre>
You can, of course, use the default arguments where applicable.

<p>
Note that the standard JS9 colormaps, scale, contrast and bias
selections are applied to the raw data to regenerate the RGB
image. Thus, if you use any of the image processing techniques listed
below and then change colormap, contrast, bias, or scale, you will
undo the applied image processing. This is a good way to reset the
displayed image. The same thing can be accomplished programmatically by
specifying "reset" as the filter name:
<pre>
    JS9.FilterRGBImage("reset", {display: "myJS9"});
</pre>

<p>
The following simple image processing filters are available:
<ul>
<li><b>luminance():</b>convert to greyscale using the CIE luminance:
0.2126*r + 0.7152*g + 0.0722*b
<li><b>greyscale():</b>convert to greyscale using the standard greyscale:
0.3*r + 0.59*g + 0.11*b
<li><b>greyscaleAvg():</b>convert to greyscale using averaging:
(r+g+b) / 3
<li><b>brighten(val):</b> add constant value to each pixel to change the brightness:
[r + val, g + val, b + val]
<li><b>noise(v1, v2):</b> add random noise: 
pixel += Math.floor((Math.random()*(v2-v1)) - v2),
defaults are v1=-30, v2=30
<li><b>duotone("r"|"g"|"b"):</b> remove a color by setting it to
the avg of the two others: r=(g+b)/2, default color is "r"
<li><b>invert():</b> the RGB channels of the image are inverted:
[255-r, 255-g, 255-b, a]
<li><b>pixelate(size):</b>make image look coarser by creating a square tiling
effect of the specified size, default size is 2
<li><b>sepia():</b> image takes on shades of brown, like an antique photograph
<li><b>contrast(val):</b> change the difference in brightness between the min 
and max intensity of a pixel, default val is 2
<li><b>threshold(thresh, low, high):</b>create a two-color image in which pixels
less bright than thresh are assigned the low value (default 0 for black), 
otherwise the high value (default: 255 for white)
<li><b>gamma(gcorr):</b> apply the nonlinear gamma operation, used to code and 
decode luminance values in video or still image systems: 
out = pow(in, gcorr), default gcorr is 0.2
<li><b>posterize():</b> convert a smooth gradation of tone to regions
of fewer tones, with abrupt changes between them
<li><b>scatter():</b> scatters the colors of a pixel in its neighborhood, akin
to viewing through brittle cracked glass
<li><b>solarize():</b> which image is wholly or partially reversed in
tone. Dark areas appear light or light areas appear dark.
</ul>

<p>
The following image convolutions are available:
<ul>
<li><b>convolve(weights, [opaque])</b> convolve the image using the weights array
as a square convolution matrix. If opaque is true (default), the image will 
have an opaque alpha channel, otherwise the alpha is convolved as well.
<li><b>sobel():</b> use the Sobel operator to create an image that emphasizes the edges
<li><b>medianFilter():</b> noise reduction technique that replaces each pixel with
the median of neighboring pixels
<li><b>gaussBlur5():</b> image pixel values are blurred using a 5x5 Gaussian
<li><b>edgeDetect():</b> detect edges using the kernel
[ -1, -1, -1, -1, 8, -1, -1, -1, -1 ]
<li><b>sharpen(val):</b> sharpen the image using the kernel
[ 0, -3, 0, -3, val, -3, 0, -3, 0 ]
<li><b>blur():</b> blur the image using the kernel
[ 1, 2, 1, 2, 1, 2, 1, 2, 1 ]
<li><b>emboss(val):</b> produce embossing effect using the kernel
[-18, -9, 9, -9, 100 - val, 9, 0, 9, 18 ]
<li><b>lighten(val):</b> apply the kernel
[ 0, 0, 0, 0, val, 0, 0, 0, 0 ],
default val of 12/9 lightens the image
<li><b>darken(val):</b> apply the kernel
[ 0, 0, 0, 0, val, 0, 0, 0, 0],
default val of 6/9 darkens the image
</ul>

<p>
With no arguments, the routine returns an array of available filters:
<pre>
    JS9.FilterRGBImage()
    ["convolve", "luminance", ..., "blur", "emboss", "lighten", "darken"]
</pre>

<h5 id="JS9.ReprojectData">Reproject an image using a specified WCS</h5>
<p>
<code class="api">JS9.ReprojectData(wcsim, opts)</code>
<p>
where:
<ul>
<li><b>wcsim</b>: image containing the WCS used to perform the reprojection
<li><b>opts</b>: options object
</ul>
<b>JS9.ReprojectData()</b> creates a new raw data layer (with default id
of "reproject") in which the pixels are reprojected using the WCS from
another image. The
<a href="http://montage.ipac.caltech.edu/docs/mProjectPP.html">mProjectPP</a>
program from the 
<a href="http://montage.ipac.caltech.edu/">Montage</a> software suite
is used to perform the reprojection.  Please read the documentation on
mProjectPP from the Montage web site, which includes this explanation:
<p>
<pre>
    mProjectPP performs a plane-to-plane transform on the input image, and
    is an adaptation of the Mopex algorithm and developed in collaboration
    with the Spitzer Space Telescope. It provides a speed increase of
    approximately a factor of 30 over the general-purpose mProject. However,
    mProjectPP is only suitable for projections which can be approximated
    by tangent-plane projections (TAN, SIN, ZEA, STG, ARC), and is therefore
    not suited for images covering large portions of the sky. Also note that
    it does not directly support changes in coordinate system (i.e. equatorial
    to galactic coordinates), though these changes can be facilitated by the
    use of an alternate header.
</pre>

<p>
The <b>wcsim</b> argument is an image id, image filename, or image
object pointing to the WCS image.

<p>
The <b>opts</b> object can contain the following reproject-specific properties:
<ul>
<li><b>rawid</b>: the id of the raw data layer to create (default: "reproject")
<li><b>cmdswitches</b>: a string containing mProjectPP command line switches
</ul>
The cmdswitches will be prepended to the mProjectPP command line. For example:
<pre>
 {cmdswitches: "-d 1 -z .75"}
</pre>
will set the mProjectPP debugging and the drizzle factor, resulting in a
command line that looks like this:
<pre>
  mProjectPP -d 1 -z .75 -s statusfile in.fits out.fits template.hdr
</pre>
See the 
<a href="http://montage.ipac.caltech.edu/docs/mProjectPP.html">mProjectPP</a>
documentation for more information about command switches.

<p>
Reprojection is an intensive process which can take a considerable
amount of memory and processing time. To avoid crashes, we currently
restrict the WCS image size used for reprojection to a value defined
by JS9.REPROJDIM, currently 2300 x 2300. Even this might be too large
for iOS devices under certain circumstances, although issues regarding
memory are evolving rapidly.

<h5 id="JS9.RotateData">Rotate an image around the  WCS CRPIX point</h5>
<p>
<code class="api">JS9.RotateData(angle, opts)</code>
<p>
where:
<ul>
<li><b>angle</b>: rotation angle in degrees
<li><b>opts</b>: options object
</ul>
The <b>JS9.RotateData()</b> routine uses
<a href="#JS9.ReprojectData"><b>JS9.ReprojectData()</b></a>
to rotate image data by the specified angle (in degrees). If the string
"northup" or "northisup" is specified, the rotation angle is set to 0.
The rotation is performed about the WCS CRPIX1, CRPIX2 point.
<p>
The optional opts object is passed directly to the <b>JS9.ReprojectData()</b>
routine. See <b>JS9.ReprojectData()</b> above for more information.

<h5 id="JS9.SaveSession">Save an image session to a file</h5>
<p>
<code class="api">JS9.SaveSession(session, opts)</code>
<p>
where:
<ul>
<li><b>session</b>: optional name of the file to create when saving this session
<li><b>opts</b>: optional object or json string containing session parameters
</ul>
<p>
This routine saves session information related to the currently
displayed image or all images in the specified display. The first
argument can be a filename or an options object. If a filename is
specified, the second argument can be the options object.
<p>
The <b>opts</b> options object supports a <b>mode</b> property
whose value can be "display" (save all images in the specified
display) or "image" (save the currently displayed image. If this
property is not specified, the default is to save all images in the display.
<p>
If no filename is specified, the default filename depends on the save mode.
If mode is "display", the default filename takes the form <b>js9-[date].ses</b>,
e.g. "js9-2018-01-09.ses". If mode is "image", the default filename is <b>[im.id].ses</b>, e.g. "casa.fits.ses".
<p>
Saved information (filename, scaling, colormap, contrast/bias, zoom,
regions, catalogs, etc) is stored in a json-formatted text file. You can
subsequently load this file into JS9 to restore the image session.
Don't forget that the file is saved by the browser in whatever location
you have set up for downloads.
<p>
The session file is a text file and can be edited, subject to the usual
rules of json formatting. For example, you can change the colormap,
scaling, etc. after the fact.
<p>
The session file contains a <b>file</b> property near the top that
specifies the location of the image. A local file usually will contain
an absolute path or a path relative to the web page being displayed.
However, if the image was originally opened using drag-and-drop, no
pathname information is available, in accordance with standard web
security protocols. In this case, you must edit the session file to
supply the path (either absolute or relative to the web page) before
re-loading the session.

<h5 id="JS9.LoadSession">Load a previously saved image session from a file</h5>
<p>
<code class="api">JS9.LoadSession(session)</code>
<p>
where:
<ul>
<li><b>session</b>: name of the session file to load
</ul>
<p>
Restore an image session by loading a json-formatted session file. The
image itself is retrieved and loaded, and all of the saved parameters
and graphics (scale, colormap, regions, catalogs etc) are applied to
the display.
<p>
The session file contains a <b>file</b> property near the top that
specifies the location of the image. A local file usually will contain
an absolute path or a path relative to the web page being displayed.
However, if the image was originally opened using drag-and-drop, no
pathname information is available, in accordance with standard web
security protocols. In this case, you must edit the session file to
supply the path (either absolute or relative to the web page) before
re-loading the session.
<p>
Note that the raw data file itself is not saved (only its pathname),
so you must have access to that file in order to restore a session. However,
the data file need not be in the same location as it was originally: you
can adjust the path of the data file by editing the <b>file</b> property
as needed.

<p><hr>
  
<h4 id="regions">Working with Regions</h4>
  
<p>
Spatial regions of interest are a crucial part of astronomical data
analysis. The regions layer is a special case of the more generalized
<b><a href="#shapes">Shape</a></b> layers, automatically created by
JS9 to support the options in the <b>Regions</b> menu, as well as
local and server-side data analysis using regions. As such, these
region routines are just a thin layer on top of the Shape routines,
calling the equivalent Shape routine with "region" as the first argument.

<p>
Note that the
<b><a href="#JS9.GetRegions">GetRegions()</a>,
<a href="#JS9.ChangeRegions">ChangeRegions()</a>,
<a href="#JS9.RemoveRegions">RemoveRegions()</a></b> calls
all take a regions specification as the second argument, which can be
any of the following (in order of precedence):
<ul>
<li><b>"all"</b>: all regions
<li><b>[id]</b>: a specific region id returned by
  <a href="#JS9.AddRegions"><b>JS9.AddRegions()</b></a>
<li><b>"selected"</b>: the selected region (or all regions in the selected group)
<li><b>[color]</b>: all regions having the specified color (e.g., "red")
<li><b>[shape]</b>: all regions having the specified shape (e.g., "circle")
<li><b>[tag]</b>: all regions containing the specified tag (e.g., "source")
</ul>
Thus, it is possible to act on multiple regions at the same time.

<h5 id="JS9.AddRegions">Add one or more regions to the regions layer</h5>
<p>
<code class="api">id = JS9.AddRegions(rarr, opts)</code>
<p>
where:
<ul>
<li><b>rarr</b>: a shape string, region object or an array of region objects
<li><b>opts</b>: global values to apply to each created region
</ul>
returns:
<ul>
<li><b>id</b>: id of last region created
</ul>
The <b>rarr</b> argument can be a region shape ("annulus", "box",
"circle", "ellipse", "point", "polygon", "text"), a single region
object, or an array of region objects. Region objects contain one or
more properties, of which the most important are:
<ul>
<li><b>shape</b>: "annulus", "box", "circle", "ellipse", "point", "polygon", "text" <b>[REQUIRED]</b>
<li><b>x</b>: image x position
<li><b>y</b>: image y position
<li><b>px</b>: physical x position
<li><b>py</b>: physical y position
<li><b>lcs</b>: object containing logical x, y and sys (e.g. "physical")
<li><b>dx</b>: increment from current image x position
<li><b>dy</b>: increment from current image y position
<li><b>tags</b>: comma-separated list of tag strings or array of tag strings
<li><b>radii</b>: array of radii for annulus region
<li><b>width</b>: width for box region
<li><b>height</b>: height for box region
<li><b>radius</b>: radius value for circle region
<li><b>r1</b>:  x radius for ellipse region (misnomer noted)
<li><b>r2</b>:  y radius for ellipse region (misnomer noted)
<li><b>pts</b>: array of objects containing x and y positions for polygons
<li><b>points</b>: array of objects containing x and y offsets from the center for polygons
<li><b>angle</b>: angle in degrees for box and ellipse regions
<li><b>color</b>: region color (string name or #rrggbb syntax)
<li><b>text</b>: text associated with text region or for a child region of this region
<li><b>data</b>: this property can be an object, string, number,
etc. and will be carried along with the region, and returned as a
property by the <b>JS9.GetRegions()</b> call.
</ul>
Other available properties include:
<ul>
<li><b>changeable</b>: if false, region cannot be moved, resized, rotated
<li><b>movable</b>: if false, region cannot be moved
<li><b>resizable</b>: if false, region cannot be resized or rotated
<li><b>rotatable</b>: if false, region cannot be rotated
<li><b>removable</b>: if false, region cannot be removed
<li><b>zoomable</b>: if false, region is not resized when image is zoomed
<li><b>lockMovementX</b>: if true, region cannot be moved in the x direction
<li><b>lockMovementY</b>: if true, region cannot be moved in the y direction
<li><b>lockRotation</b>: if true, region cannot be rotated
<li><b>fontFamily</b>: font parameter for text region
<li><b>fontSize</b>: font parameter for text region
<li><b>fontStyle</b>: font parameter for text region
<li><b>fontWeight</b>: font parameter for text region
</ul>
Deprecated properties:
<ul>
<li><b>fixinplace</b>: opposite of changeable
</ul>
Here are some examples of ways to create regions:
<pre>
    # example 1: circular region in the center of the field
    JS9.AddRegions("circle");

    # example 2: red circular region in the center of the field
    JS9.AddRegions("circle", {color: "red"});

    # example 3: red circular region with dashed lines
    JS9.AddRegions("circle", {color: "red", strokeDashArray: [3,1]});

    # example 4: regions using an object in first arg
    JS9.AddRegions({shape: "circle", color: "red", strokeDashArray: [3,1]})

    # example 5: multiple regions using an array specification in first arg
    JS9.AddRegions([{shape: "circle", color: "red", strokeDashArray: [3,1]},
                    {shape: "box", color: "green", strokeDashArray: [6,1]}])

    # example 6: js9 region syntax: properties in the second arg object
    JS9.AddRegions('ellipse(23:23:22.179, +58:48:10.542, 40", 20", 60)', {text: "ellipse test", color: "violet", tags: "json tag, another tag", textOpts: {color: "yellow", fontSize: 16, fontStyle: "italic", fontWeight: "bold"}});

    # example 7: js9 region syntax: json properties in the first arg string
    JS9.AddRegions('ellipse(23:23:22.179, +58:48:10.542, 40", 20", 60) {"color": "violet", "text": "ellipse test", "textOpts": {"color": "yellow", "fontSize": 16, "fontStyle": "italic", "fontWeight": "bold"}} # json tag, another tag');

    # example 8: ds9 region syntax: comment properties in the first arg string
    JS9.AddRegions('box(23:23:35.486, +58:50:03.146, 40", 20", 30) # width=4 text={box test} dash=1 color=red rotate=0 tag="test tag"')
</pre>
In sum, you can specify a region using:
<ul>
<li> a shape in the first string arg, optional properties in the second object arg
<li> properties (including the shape) in the first object arg
<li> array of objects in the first arg
<li> full region syntax in the first string arg, optional properties in the second arg
</ul>
Note the difference between examples 6 and 7: the former passes
properties in an <b>object</b> (second argument), so the key names
need not be quoted. The latter passes properties in a <b>json</b>
string as part of the first string argument: here the key names must be
quoted using double quotes, as per the json specification.

<p>
Examples 6 and 7 also show the <b>text</b> property, which allows you
to associate a text string with a non-text region. JS9 will create a
separate text region as a <b>child</b> of the original region. You can
move this child text region around relative to the original region,
change its angle, etc. The child will then maintain its new position
relative to the original region as the latter is moved, resized,
etc. You also can double-click on the text child to bring up its
configuration dialog box and change its color, font, size, text string,
etc.

<h5 id="JS9.GetRegions">Get information about one or more regions</h5>
<p>
<code class="api">rarr = JS9.GetRegions(regions)</code>
<p>
where:
<ul>
<li><b>regions</b>: which regions to retrieve
</ul>
returns:
<ul>
<li><b>rarr</b>: array of region objects
</ul>
<p>
If the <b>regions</b> argument is not specified, it defaults to "all". You
can specify regions using any of the following:
<ul>
<li><b>all</b>: all regions
<li><b>selected</b>: the selected region (or regions in a selected group)
<li><b>[color]</b>: regions of the specified color
<li><b>[shape]</b>: regions of the specified shape
<li><b>[tag]</b>:  regions having the specified tag
<li><b>/[regexp]/</b>: regions with a tag matching the specified regexp
</ul>
In this context, a regexp is a string enclosed between slashes.e.g.,
"/foo[1-4]/" will match regions with tags "foo1", "foo2", "foo3", or "foo4";

<p>
Each returned region object contains the following properties:
<ul>
<li><b>id</b>: numeric region id (assigned by JS9 automatically)
<li><b>mode</b>: "add", "remove", "select", "update"
<li><b>shape</b>: region shape ("annulus", "box", "circle", "ellipse",
"point", "polygon", "text")
<li><b>tags</b>: comma delimited list of region tags (e.g., "source", "include")
<li><b>color</b>: region color
<li><b>x,y</b>: image coordinates of region
<li><b>radii</b>: array of radii for annulus region
<li><b>width</b>: width for box region
<li><b>height</b>: height for box region
<li><b>radius</b>: radius value for circle region
<li><b>r1</b>:  x radius for ellipse region (misnomer noted)
<li><b>r2</b>:  y radius for ellipse region (misnomer noted)
<li><b>pts</b>: array of objects containing x and y positions, for polygons
<li><b>points</b>: array of objects containing x and y offsets from the specified center, for polygons
<li><b>angle</b>: angle in degrees for box and ellipse regions
<li><b>ra</b>: RA of center in degrees
<li><b>dec</b>: Dec of center in degrees
<li><b>wcsstr</b>: region string in wcs coordinates
<li><b>wcssys</b>: wcs system (e.g. "FK5")
<li><b>imstr</b>: region string in image or physical coordinates
<li><b>imsys</b>: image system ("image" or "physical")
<li><b>data</b>: data property passed in options object when this shape was created.
</ul>
The image position can be used to access the image data returned by the
<b>JS9.GetImageData()</b> routine:
<pre>
    obj = JS9.GetImageData();
    xreg = JS9.GetRegions("selected")[0];
    val = obj.data[Math.floor(xreg.y-1) * obj.width + Math.floor(xreg.x-1)];
</pre>
<p>
Note the need to integerize the x and y values: JavaScript arrays are
objects and so floating point array indices do not get truncated
automatically as in C. They will return null values.

<h5 id="JS9.ChangeRegions">Change one or more regions</h5>
<p>
<code class="api">JS9.ChangeRegions(regions, opts)</code>
<p>
where:
<ul>
<li><b>regions</b>: which regions to change
<li><b>opts</b>: object containing options to change in each region
</ul>
Change one or more regions. 
If the <b>regions</b> argument is not specified, it defaults to "all". You
can specify regions using any of the following:
<ul>
<li><b>all</b>: all regions
<li><b>selected</b>: the selected region (or regions in a selected group)
<li><b>[color]</b>: regions of the specified color
<li><b>[shape]</b>: regions of the specified shape
<li><b>[tag]</b>:  regions having the specified tag
<li><b>/[regexp]/</b>: regions with a tag matching the specified regexp
</ul>
In this context, a regexp is a string enclosed between "/"
slashes.e.g. "/foo[1-4]/" will match "foo1", "foo2", "foo3", "foo4";

<p>
The opts object can contain the parameters 
described in the
<a href="#JS9.AddRegions"><b>JS9.AddRegions()</b></a>
section. However, you cannot (yet)
change the shape itself (e.g. from "box" to "circle"). See js9onchange.html
for examples of how to use this routine.

<h5 id="JS9.CopyRegions">Copy one or more regions to another image</h5>
<p>
<code class="api">JS9.CopyRegions(to, regions)</code>
<p>
where:
<ul>
<li><b>to</b>: image id to which to copy regions
<li><b>regions</b>: which regions to copy
</ul>
Copy regions to a different image. If <b>to</b> is "all", then the regions are
copied to all images.
<p>
If the <b>regions</b> argument is not specified, it defaults to "all". You
can specify regions using any of the following:
<ul>
<li><b>all</b>: all regions
<li><b>selected</b>: the selected region (or regions in a selected group)
<li><b>[color]</b>: regions of the specified color
<li><b>[shape]</b>: regions of the specified shape
<li><b>[tag]</b>:  regions having the specified tag
<li><b>/[regexp]/</b>: regions with a tag matching the specified regexp
</ul>
In this context, a regexp is a string enclosed between "/"
slashes.e.g. "/foo[1-4]/" will match "foo1", "foo2", "foo3", "foo4";

<h5 id="JS9.RemoveRegions">Remove one or more regions from the region layer</h5>
<p>
<code class="api">JS9.RemoveRegions(regions)</code>
<p>
where:
<ul>
<li><b>regions</b>: which regions to remove
</ul>
If the <b>regions</b> argument is not specified, it defaults to "all". You
can specify regions using any of the following:
<ul>
<li><b>all</b>: all regions
<li><b>selected</b>: the selected region (or regions in a selected group)
<li><b>[color]</b>: regions of the specified color
<li><b>[shape]</b>: regions of the specified shape
<li><b>[tag]</b>:  regions having the specified tag
<li><b>/[regexp]/</b>: regions with a tag matching the specified regexp
</ul>
In this context, a regexp is a string enclosed between "/"
slashes.e.g. "/foo[1-4]/" will match "foo1", "foo2", "foo3", "foo4";

<h5 id="JS9.SaveRegions">Save regions from the current image to a file</h5>
<p>
<code class="api">JS9.SaveRegions(filename, which, layer)</code>
<p>
where:
<ul>
<li><b>filename</b>: output file name
<li><b>which</b>: which regions to save (default is "all")
<li><b>layer</b>: which layer save (default is "regions")
</ul>
Save the current regions for the displayed image as a JS9 regions file. If
filename is not specified, the file will be saved as "js9.reg".

<p>
Don't forget that the file is saved by the browser, in whatever location
you have set up for downloads.

<p>
If the <b>which</b> argument is not specified, it defaults to "all". You
can specify "selected" to return information about the selected regions, or
a tag value to save regions having that tag.

<p>
If the <b>layer</b> argument is not specified, it defaults to
"regions", i.e.  the usual regions layer. You can specify a different
layer, e.g., if you want to save a catalog layer as a region file
(since
<a href="#JS9.SaveCatalog"><b>SaveCatalog()</b></a>
will save the data in table format instead of as regions).

<h5 id="JS9.ToggleRegionTags">Toggle region tags from the current image</h5>
<p>
<code class="api">JS9.ToggleRegionTags(which, t1, t2)</code>
<p>
where:
<ul>
<li><b>which</b>: which regions to process (default is "all")
<li><b>t1</b>: tag#1
<li><b>t2</b>: tag#2
</ul>
While region tags can be changed using the
<a href="#JS9.ChangeRegions"><b>ChangeRegions()</b></a> routine, a
bespoke user interface might want to toggle between a <b>source</b>
region and <b>background</b> region, or between <b>include</b> and
<b>exclude</b>. This convenience routine will do that. For example:
<pre>
    JS9.ToggleRegionTags("selected", "source", "background");
</pre>
will change a <b>background</b> region into a <b>source/</b> region
or vice-versa, depending on the state of the region, while:
<pre>
    JS9.ToggleRegionTags("selected", "include", "exclude");
</pre>
will toggle between <b>include</b> and <b>exclude</b>.

<h5 id="JS9.LoadRegions">Load regions from a file into the current image</h5>
<p>
<code class="api">JS9.LoadRegions(filename, opts)</code>
<p>
where:
<ul>
<li><b>filename</b>: input file name or URL
<li><b>opts</b>: global region options for all regions
</ul>
Load the specified regions file into the displayed image. The filename, 
which must be specified, can be a local file (with absolute path or a
path relative to the displayed web page) or a URL.
<p>
The <b>opts</b> property specifies global options that are applied to
all regions in the file. They will be over-ridden by individual region
properties attached to a given region.  For example, if a region file
named "foo.reg" contains the following regions:
<pre>
    # Region file format: JS9 version 1.0
    image
    circle(512.0, 512.0, 40) {"color": "red"}
    box(512.0, 512.0, 40, 40)
    annulus(512.0, 512.0, 0.0, 3.0, 12.0, 18.0, 27.0)
</pre>
then a command such as:
<pre>
    JS9.LoadRegions("foo.reg", {color: "blue"});
</pre>
will create a red circle, a blue box, and a blue annulus.

<p><hr>
  
<h4 id="shapes">Working with Shape Layers</h4>
  
<p>
JS9 supports individual layers for drawing 2D graphics. The regions
layer is a special case of a shape layer, created automatically by
JS9. The Catalog plugin creates a separate layer for each catalog.
You can define your own shape layer using the <b>NewShapeLayer()</b>
call and then add geometric shapes to it.
<p>
Note that the
<b><a href="#JS9.GetShapes">JS9.GetShapes()</a>,
<a href="#JS9.ChangeShapes">JS9.ChangeShapes()</a>,
<a href="#JS9.RemoveShapes">JS9.RemoveShapes()</a></b> 
calls all take a shape specification as the second argument, which can
be any of the following (in order of precedence):
<ul>
<li><b>"all"</b>: all regions
<li><b>[id]</b>: a specific region id returned by
  <a href="#JS9.AddShapes"><b>JS9.AddShapes()</b></a>
<li><b>"selected"</b>: the selected region (or all regions in the selected group)
<li><b>[color]</b>: all regions having the specified color (e.g., "red")
<li><b>[shape]</b>: all regions having the specified shape (e.g., "circle")
<li><b>[tag]</b>: all regions containing the specified tag (e.g., "source")
</ul>
Thus, it is possible to act on multiple shapes at the same time.

<h5 id="JS9.NewShapeLayer">Create a new shape layer</h5>
<p>
<code class="api">lid = JS9.NewShapeLayer(layer, opts)</code>
<p>
where:
<ul>
<li><b>layer</b>: name of the layer to create
<li><b>opts</b>: default options for this layer
</ul>
returns:
<ul>
<li><b>lid</b>: layer id
</ul>
This routine creates a new named shape layer. You can then, add, change,
and remove shapes in this layer using the routines below. The catalogs
displayed by the Catalog plugin are examples of separate shape layers.
<p>
The <b>opts</b> parameter allows you to specify default options for
the new layer. Although this argument is optional, you generally will
want to set default values for various properties utilized by your
new shape layer. See JS9.Regions.opts in js9.js for example of the default
options for the regions layer. This is a good set of options to pass if
you want region-like behavior in your new layer.
<p>
The JS9.Catalogs.opts object is also supplied as a possible baseline
object for new shape layers.  It differs from the JS9.Regions.opts in a
few important ways:
<ul>
<li> it makes the new layer non-interactive: individual shapes cannot be
moved, rotated, resized, or deleted, nor do they respond to events
<li> it sets the <b>updateWCS</b> property to false, so the relatively expensive operation of updating the wcs string is not performed when an object is modified
<li> it does not sort overlapping shapes so that the smallest is on top when a shape is moved
<li> it does not define regions-specific processing (e.g., double-click to edit a region parameters)
</ul>
<p>
Starting with the JS9.Catalogs.opts object as a default, you can make
the new layer interactive in a few different ways. The first way is to
set the <b>movable</b> property in the opts object to <b>true</b>.
This will permit individual shapes to be moved, rotated, resized and
deleted. Shapes also will be movable and resizable as a group.
<p>
The second way is to supply one or more event callbacks as properties
to the opts object:
<ul>
<li> <b>onmousedown</b>: function(im, xreg, evt);
<li> <b>onmouseup</b>: function(im, xreg, evt);
<li> <b>onmousemove</b>: function(im, xreg, evt);
<li> <b>onmouseover</b>: function(im, xreg, evt);
<li> <b>onmouseout</b>: function(im, xreg, evt);
</ul>
When the associated mouse event occurs on a shape, these functions
will be called with the following arguments:
<ul>
<li> <b>im</b>: the image handle for the currently displayed image
<li> <b>xreg</b>: the shape object, as described in JS9.GetShapes()
<li> <b>evt</b>: the original event object
</ul>
For example, to define mouseover and mousedown callbacks:
<pre>
    opts.onmouseover = function(im, xreg, evt){
        console.log("mouseover: %s %s", im.id, xreg.data.tag);
    };
    opts.onmousedown = function(im, xreg, evt){
        console.log("mousedown: %s %s", im.id, xreg.data.tag);
</pre>
Note that the shapes are still not movable unless you also set
the <b>movable</b> property.
<p>
In addition to firing callbacks on events for individual shapes, you
can set the <b>ongroupcreate</b> property in the opts object to a
function that will fire when two or more objects are selected into a
group (which is done using the <b>Command</b> key on a Mac,
or <b>Control</b> key everywhere else):
<ul>
<li><b>ongroupcreate</b>: function(im, xregs, evt);
</ul>
The function will be called with the following arguments:
<ul>
<li> <b>im</b>: the image handle for the currently displayed image
<li> <b>xregs</b>: an array of shape objects within the group
<li> <b>evt</b>: the original event object
</ul>
Note that an array of xreg objects is passed in this case instead of
the single "current" object passed in the other event callbacks.
For example:
<pre>
    opts.ongroupcreate = function(im, xregs, evt){
        var i, nshape, xcen, ycen;
        var xtot=0, ytot=0;
        nshape = xregs.length;
        for(i=0; i&lt;nshape; i++){
          xtot += xregs[i].x; ytot += xregs[i].y;
        }
        xcen = xtot / nshape; ycen = ytot / nshape;
        console.log("average pos for %s objects: %s,%s", nshape, xcen, ycen);
    }
</pre>
<p>
The final way to make a shape layer interactive is to specify
a <b>tooltip</b> to display when hovering over objects in this shape
layer. This is done by assigning a tooltip format string to
the <b>tooltip</b> property of the opts object.  This string can
contain HTML directives, and it also can contain references to
properties in the im, xreg, and evt objects. When the mouse hovers
over an object, a tooltip string is generated by macro-expanding the
values for these properties. The generated tooltip string is displayed
as the inner HTML of the tooltip. When the mouse leaves the object,
the tooltip is hidden.
<p>
For example, consider the following tooltip string:
<pre>
    opts.tooltip = "&lt;b&gt;id: $im.id&lt;/b&gt;&lt;br&gt;pos: $xreg.x $xreg.y&lt;br&gt;&lt;i&gt;$xreg.data.tag&lt;/i&gt;";
</pre>
Note how properties of the <b>im</b> and <b>xreg</b> objects are
specified with a "$" prefix. When the mouse hovers over an object, the
generated tooltip will display current image id in bold, followed by
that object's x,y pixel position, followed by a user <b>tag</b>
property passed in the <b>data</b> object when the shape was added.

<h5 id="JS9.ShowShapeLayer">Show or hide the specified shape layer</h5>
<p>
<code class="api">JS9.ShowShapeLayer(layer, mode)</code>
<p>
where:
<ul>
<li><b>layer</b>: name of layer
<li><b>mode</b>: true (show layer) or false (hide layer)
</ul>
Shape layers can be hidden from display. This could be useful, for
example, if you have several catalogs loaded into a display and
want to view one at a time.

<h5 id="JS9.ActiveShapeLayer">Make the specified shape layer the active layer</h5>
<p>
<code class="api">JS9.ActiveShapeLayer(layer)</code>
<p>
where:
<ul>
<li><b>layer</b>: name of layer
</ul>
returns:
<ul>
<li><b>active</b>: the active shape layer (if no args are specified)
</ul>

For a given image, one shape layer at a time is <b>active</b>,
responding to mouse and touch events. Ordinarily, a shape layer
becomes the active layer when it is first created and shapes are
added to it. Thus, the first time you create a region, the regions
layer becomes active. If you then load a catalog into a catalog layer,
that layer becomes active.

<p>
If no arguments are supplied, the <b>JS9.ActiveShapeLayer()</b>
routine returns the currently active layer. Specify the name of a
layer as the first argument to make it active. Note that the specified
layer must be visible.

<p>
This routine forms the basis for the <b>Shape Layer</b> plugin, which
provides a graphical way to make a layer active (by moving it to the
top of the layer stack).

<h5 id="JS9.AddShapes">Add one or more shapes to the specified layer</h5>
<p>
<code class="api">JS9.AddShapes(layer, sarr, opts)</code>
<p>
where:
<ul>
<li><b>layer</b>: name of layer
<li><b>sarr</b>: a shape string, shape object, or an array of shape objects
<li><b>opts</b>: global values to apply to each created shape
</ul>
returns:
<ul>
<li><b>id</b>: id of last shape created
</ul>
The <b>sarr</b> argument can be a shape ("annulus", "box",
"circle", "ellipse", "point", "polygon", "text"), a single shape
object, or an array of shape objects. Shape objects contain one or
more properties, of which the most important are:
<ul>
<li><b>shape</b>: "annulus", "box", "circle", "ellipse", "point", "polygon", "text" <b>[REQUIRED]</b>
<li><b>x</b>: image x position
<li><b>y</b>: image y position
<li><b>dx</b>: increment from current image x position
<li><b>dy</b>: increment from current image y position
<li><b>tags</b>: comma-separated list of tag strings or array of tag strings
<li><b>radii</b>: array of radii for annulus shape
<li><b>width</b>: width for box shape
<li><b>height</b>: height for box shape
<li><b>radius</b>: radius value for circle shape
<li><b>r1</b>:  x radius for ellipse shape (misnomer noted)
<li><b>r2</b>:  y radius for ellipse shape (misnomer noted)
<li><b>pts</b>: array of objects containing x and y positions, for polygons
<li><b>points</b>: array of objects containing x and y offsets from the specified center, for polygons
<li><b>angle</b>: angle in degrees for box and ellipse shapes
<li><b>color</b>: shape color (string name or #rrggbb syntax)
<li><b>text</b>: text associated with text shape
<li><b>data</b>: this property can be an object, string, number,
etc. and will be carried along with the shape, and returned as a
property by the
<a href="#JS9.GetShapes"><b>JS9.GetShapes()</b></a> call.
</ul>
Other available properties include:
<ul>
<li><b>changeable</b>: if false, region cannot be moved, resized, rotated
<li><b>movable</b>: if false, region cannot be moved
<li><b>resizable</b>: if false, region cannot be resized or rotated
<li><b>rotatable</b>: if false, region cannot be rotated
<li><b>removable</b>: if false, region cannot be removed
<li><b>zoomable</b>: if false, region is not resized when image is zoomed
<li><b>lockMovementX</b>: if true, region cannot be moved in the x direction
<li><b>lockMovementY</b>: if true, region cannot be moved in the y direction
<li><b>lockRotation</b>: if true, region cannot be rotated
<li><b>fontFamily</b>: font parameter for text region
<li><b>fontSize</b>: font parameter for text region
<li><b>fontStyle</b>: font parameter for text region
<li><b>fontWeight</b>: font parameter for text region
</ul>
Deprecated properties:
<ul>
<li><b>fixinplace</b>: opposite of changeable
</ul>

<h5 id="JS9.RemoveShapes">Remove one or more shapes from the specified shape layer</h5>
<p>
<code class="api">JS9.RemoveShapes(layer, shapes)</code>
<p>
where:
<ul>
<li><b>layer</b>: name of layer
<li><b>shapes</b>: which shapes to remove
</ul>

<h5 id="JS9.GetShapes">Get information about one or more shapes in the specified shape layer</h5>
<p>
<code class="api">JS9.GetShapes(layer, shapes)</code>
<p>
where:
<ul>
<li><b>layer</b>: name of layer
<li><b>shapes</b>: which shapes to retrieve
</ul>
returns:
<ul>
<li><b>sarr</b>: array of shape objects
</ul>
<p>
Each returned shape object contains the following properties:
<ul>
<li><b>id</b>: numeric region id (assigned by JS9 automatically)
<li><b>mode</b>: "add", "remove", or "change"
<li><b>shape</b>: region shape ("annulus", "box", "circle", "ellipse",
"point", "polygon", "text")
<li><b>tags</b>: comma delimited list of region tags (e.g., "source", "include")
<li><b>color</b>: region color
<li><b>x,y</b>: image coordinates of region
<li><b>size</b>: object containing width and height for box region
<li><b>radius</b>: radius value for circle region
<li><b>radii</b>: array of radii for annulus region
<li><b>eradius</b>: object containing x and y radii for ellipse regions
<li><b>pts</b>: array of objects containing x and y positions, for polygons
<li><b>angle</b>: angle in degrees for box and ellipse regions
<li><b>data</b>: data property passed in options object when this shape was created.
</ul>

<h5 id="JS9.ChangeShapes">Change one or more shapes in the specified layer</h5>
<p>
<code class="api">JS9.ChangeShapes(layer, shapes, opts)</code>
<p>
where:
<ul>
<li><b>layer</b>: name of layer
<li><b>shapes</b>: which shapes to change
<li><b>opts</b>: object containing options to change in each shape
</ul>
Change one or more shapes. The opts object can contain the parameters 
described in the
<a href="#JS9.AddShapes"><b>JS9.AddShapes()</b></a>
section. However, you cannot (yet)
change the shape itself (e.g. from "box" to "circle").

<h5 id="JS9.LoadCatalog">Load an astronomical catalog</h5>
<p>
<code class="api">JS9.LoadCatalog(layer, table, opts)</code>
<p>
where:
<ul>
<li><b>layer</b>: name of shape layer into which to load the catalog
<li><b>table</b>: string or blob containing the catalog table, or file name
<li><b>opts</b>: catalog options
</ul>
Astronomical catalogs are a special type of JS9 shape layer, in which
the shapes have been generated from a tab-delimited text file of
columns, including two columns that contain RA and Dec values. An
astronomical catalog can have a pre-amble of comments, which, by
default, have a '#' character in the first column.

<p>
Two examples of catalog files are shown below:
<pre>
  ra        	dec        	magj	magh	magk
  -----------	------------	------	----	----
  23:22:56.003	58:44:45.429	15.612	15.103	14.9
  23:22:56.230	58:45:32.011	13.723	13.174	12.981
  23:22:56.319	58:45:08.954	14.212	13.119	12.723
  ...

  #
  #   VizieR Astronomical Server vizier.u-strasbg.fr
  # ...
  #Coosys	J2000:	eq_FK5 J2000
  # ...
  #Title: 2MASS All-Sky Catalog of Point Sources (Cutri+ 2003)
  # ...
  #Column	_RAJ2000	(A12)		[ucd=pos.eq.ra]
  #Column	_DEJ2000	(A12)		[ucd=pos.eq.dec]
  #Column	RAJ2000	(F10.6)		[ucd=pos.eq.ra;meta.main]
  #Column	DEJ2000	(F10.6)		[ucd=pos.eq.dec;meta.main]
  #Column	2MASS	(a17)		[ucd=meta.id;meta.main]
  # ...
  #Column	Aflg	(I1)		[ucd=meta.code]
  _RAJ2000	_DEJ2000	RAJ2000	DEJ2000	2MASS	Jmag	e_Jmag	Hmag	  e_Hmag	Kmag	e_Kmag	Qflg	Rflg	Bflg	Cflg	Xflg	Aflg
  ------------	------------	----------	----------	-----------------	------	------	------	------	------	------	---	---	---	---	-	-
  23 22 56.002	+58 44 45.43	350.733342	+58.745953	23225600+5844454 	15.612	 0.064	15.103	 0.078	14.900	 0.121	AAB	222	111	ccc	0	0
  23 22 59.647	+58 44 56.84	350.748531	+58.749123	23225964+5844568 	15.580	 0.063	14.922	 0.072	14.506	 0.079	AAA	222	111	c00	0	0
  23 22 56.981	+58 44 44.61	350.737422	+58.745724	23225698+5844446 	14.920	 0.049	14.292	 0.049	14.002	 0.055	AAA	222	111	ccc	0	0
  ...
</pre>
Notice that both files have a tab-delimited header, followed by a
tab-delimited line of dashes, followed by tab-delimited data rows. This file 
format is sometimes called "tsv"  or "tab-separated values". A very useful
astronomical package for manipulating tables is
<a href="http://hopper.si.edu/wiki/mmti/Starbase">Starbase</a>,
written by John Roll.

<p>
The <b>JS9.LoadCatalog()</b> routine will read a file in this format,
processing the data rows by converting the RA and Dec values into
image position values that will be displayed as shapes in a new
catalog layer.

<p>
The first argument to the <b>JS9.LoadCatalog()</b> routine is the name
of the shape layer that will contain the objects in the catalog. Specifying
the name of an existing layer is valid: previous shapes in that layer will
be removed.

<p>
The second argument is either a blob or a string containing the table
data described above. Blobs are the result of loading a local file
into the browser (e.g., the <b>load catalog</b> menu option), while
strings result from a remote XHR call (e.g., the <b>Archives and
Catalogs</b> plugin).  Alternatively, the second string argument can
be a file name or URL to load. File names are distinguished from
strings containing a table in that the latter must contain at least one
tab.

<p>
The third argument is an optional object used to specify parameters, including:
<ul>
<li><b>xcol</b>: name of the RA column in the table (default is a heuristic, see below)
<li><b>ycol</b>: name of the Dec column in the table (default is a heuristic, see below)
<li><b>wcssys</b>: wcs system (FK4, FK5, ICRS, galactic, ecliptic) (default is from globalOpts)
<li><b>shape</b>: shape of catalog object (default is from globalOpts)
<li><b>color</b>: color of catalog shapes (default is from globalOpts)
<li><b>width</b>: width of box catalog shapes (default is from globalOpts)
<li><b>height</b>: height of box catalog shapes (default is from globalOpts)
<li><b>radius</b>: radius of circle catalog shapes (default is from globalOpts)
<li><b>r1</b>: r1 of ellipse catalog shapes (default is from globalOpts)
<li><b>r2</b>: r2 of ellipse catalog shapes (default is from globalOpts)
<li><b>save</b>: save the catalog properties for each generated shape (default is from globalOpts)
<li><b>tooltip</b>: format of tooltip string to display for each object (default is from globalOpts)
<li><b>skip</b>: comment character in table file  (default is from globalOpts)
</ul>
Most of these properties have default values that are stored in
the <b>JS9.globalOpts.catalogs</b> object: manipulate that object as
needed. The values listed above also can be changed by users via
the <b>Catalog</b> tab in the <b>Preferences</b> plugin.

<p>
Note the second (Vizier) example table above does not actually have a columns
called "RA" and "Dec".  Instead, it has "_RAJ2000", "_DEJ2000", "RAJ2000",
and "DEJ2000" columns. In order to pick RA and Dec column, a heuristic is used
based on the values contained in the <b>JS9.globalOpts.catalogs.ras</b> and
<b>JS9.globalOpts.catalogs.decs</b> arrays:
<ul>
<li> the <b>opts.xcol</b>, if defined, specifies the RA column (similarly for opts.ycol and the Dec column)
<li> otherwise try to match exactly the catalog header against all the array elements in JS9.globalOpts.catalogs.ras to get the RA column (same for catalogs.decs)
<li> if no exact match, try a case-insensitive match of the catalog columns against a regular expression that begins with the first array element in JS9.globalOpts.catalogs.ras (e.g. "RA*")
<li> if no approximate match, try a case-insensitive match of the catalog columns against a regular expression containing the first array element in JS9.globalOpts.catalogs.ras (e.g. "*RA*")
</ul>
The default global JS9.globalOpts.catalogs.ras contains:
<pre>
  ras:  ["RA", "_RAJ2000", "RAJ2000"]
  decs: ["Dec", "_DEJ2000", "DEJ2000"]
</pre>
These defaults make it easy to process simple catalogs and Vizier
catalogs.

<p>
Once the RA and Dec columns are specified, the RA and Dec values from
each row are converted into image positions, and JS9 shapes are
generated to be displayed in the new catalog layer. The WCS system
used to convert RA and Dec into image coordinates can be specified
using the <b>opts.wcssys</b> or <b>JS9.globalOpts.catalogs.wcssys</b>
properties.

<p>
The RA and Dec of the catalog object are always saved in the data
object of each generated shape, for use in the tooltip string. In
addition, if opts.save (or the default: JS9.globalOpts.catalogs.save)
property is not false, all of the catalog object properties will also be
save in the data object for use in the tooltip string, e.g.:
<pre>
  opts.tooltip = "$xreg.data.ra $xreg.data.dec $xreg.data.Qflg $xreg.data.Rflg"
</pre>
in the above VizieR example. Caveat: any "." (dot) in any catalog property
name will be converted to "_" (underscore) automatically. For a more detailed
discussion of tooltips, please see
<a href="#JS9.NewShapeLayer"><b>JS9.NewShapeLayer()</b></a>.

<p>
When catalog layer has been created, you can use the <b>Shape Layers</b>
plugin to toggle its visibility and also to change its position in the layer
stack.

<h5 id="JS9.SaveCatalog">Save an astronomical catalog to a file</h5>
<p>
<code class="api">JS9.SaveCatalog(filename, which)</code>
<p>
where:
<ul>
<li><b>filename</b>: output file name
<li><b>which</b>: layer containing catalog objects to save
</ul>
Save the specified catalog-containing layer as a text file. If filename is not
specified, the file will be saved as [layer].cat.

<p>
Don't forget that the file is saved by the browser, in whatever location
you have set up for downloads.

<p>
If the <b>which</b> argument is not specified, the catalog associated
with the current active layer will be saved. In either case, the
layer to save must actually be a catalog created from a tab-delimited
file (or URL) of catalog objects (not, for example, the regions layer).

<p><hr>
  
<h4 id="gestures">Mouse/Touch Gestures</h4>

<p>
JS9 supports the following configurable mouse and touch actions:
<ul>
<li> mouse movement with no buttons pressed
<li> mouse movement with one button pressed
<li> mouse movement with two buttons pressed
<li> touch with one finger
<li> touch with two fingers
<li> touch with three fingers
</ul>
The initial actions are defined by the <b>JS9.globalOpts.mouseActions</b>
and <b>JS9.globalOpts.touchActions</b> arrays. In addition, the
<b>JS9.globalOpts.mousetouchZoom</b> property specifies whether a mouse wheel
or touch/pinch will zoom the image. The default actions are:
<ul>
<li> <b>mouseActions:</b> ["display value/position", "change contrast/bias", "pan the image"]
<li> <b>touchActions:</b> ["display value/position", "change contrast/bias", "pan the image"]
<li> <b>mousetouchZoom:</b> false
</ul>
where the array elements map to an increasing numbers of
buttons/fingers.  You can change the default actions of the elements
in either array in your js9Prefs.json file. For example, to make pan
and zoom the default one-touch and pinch actions respectively:
<ul>
<li> <b>touchActions:</b> ["pan the image", "display value/position", "change contrast/bias"]
<li> <b>mousetouchZoom:</b> true
</ul>
As usual, the defaults in js9Prefs.json are used by all JS9 displays in
a web page.

<p>
Users can change the action assignments using the <b>MouseTouch</b>
plugin, which displays the current mapping between mouse/touch gesture
and its action. Simply drag and drop an action to a different gesture
in order to change the mapping. You also can toggle the scroll/pinch
to zoom capability by clicking its button.

<p>
Web page developers can extend the available mouse and touch actions
beyond the defaults contained in
<a href="../plugins/core/mousetouch.js">the Mouse Touch plugin</a>. To
add a new action, first write a function with the following calling sequence:
<pre>
    gestureFunc(im, ipos, evt)
</pre>
where:
<ul>
<li><b>im</b>: image handle
<li><b>ipos</b>: image position object containing 1-indexed x and y image
coordinate values
<li><b>evt</b>: a JavaScript or jQuery event
</ul>
Add this new function to the JS9.MouseTouchActions array, using a
descriptive name as its array index, e.g.:
<pre>
    JS9.MouseTouch.Actions["all contrast/bias"] = function(im, ipos, evt){
      var i, myim;
      for(i=0; i&lt;JS9.displays.length; i++){
        myim = JS9.displays[i].image;
        if( myim ){
          JS9.MouseTouch.Actions["change contrast/bias"](myim, ipos, evt);
        }
      }
    };
</pre>
At this point, the <b>Mouse Touch Plugin</b> will display the new
function in its list of available actions. Users can move it into one
of the defined gestures to activate it.

<p>
Of course, you can add the new action to the JS9.globalOpts.mouseActions
and/or JS9.globalOpts.touchActions arrays to make it active immediately:
<pre>
    JS9.globalOpts.mouseActions[1] = "all contrast/bias";
    JS9.globalOpts.touchActions[1] = "all contrast/bias";
</pre>
Here, we have replaced the one-button mouse move and two-button touch
move actions (whose defaults are to "change contrast/bias") with our
new action.

<p><hr>
  
<h4 id="server">Server-side Analysis</h4>

<h5 id="JS9.RunAnalysis">Run a simple server-side analysis task</h5>
<p>
<code class="api">JS9.RunAnalysis(name, parr, func)</code>
<p>
where:
<ul>
<li><b>name</b>: name of analysis tool
<li><b>parr</b>: optional array of macro-expansion options for command line
<li><b>func</b>: optional routine to call when analysis is completed on server
</ul>
The <b>JS9.RunAnalysis()</b> routine is used to execute a server-side
analysis task and return the results for further processing within the
web page.
The optional <b>parr</b> array of parameters is passed to the JS9
analysis macro expander so that values can be added to the command
line.  The array is in jQuery name/value serialized object format,
which is described here:
<pre>
    http://api.jquery.com/serializeArray/
</pre>
<p>
The <b>func()</b> routine is a callback function to process the returned
results from the analysis task.  The calling sequence is:
<pre>
    func(stdout, stderr, errcode, aobj)
</pre>
where:
<ul>
<li> <b>stdout</b>: a string containing the standard output from the task
<li> <b>stderr</b>: a string containing the standard error from the task
<li> <b>errcode</b>: error code value from the task or 0
<li> <b>aobj</b>: the analysis object from the js9Analysis.json file,
     containing, among other things, the important <b>rtype</b>:
     "text" or "plot"
</ul>
Typically, you would check stderr string first and issue an error
message if there is an error. Otherwise, the stdout string can be
processed based on the return type (rtype) property of the output
(e.g., "text" or "plot"). For plotting, you can use <b>flot</b>
functionality already loaded into JS9, or you can use your own chosen
plotting package.
<p>
If no <b>func</b> callback is specified, the default processing will
display "text" in a new light window.  If the return type is "plot",
the results are assumed to be in <b>flot</b> format and will be plotted.
<p>
Instead of passing a callback function each time, you can set the global
property <b>JS9.globalOpts.analysisFunc</b> to a function having the
same signature:
<pre>
    func(stdout, stderr, errcode, aobj)
</pre>
The specified function will be called for each execution
of <b>JS9.RunAnalysis</b>
<p>
In addition, you can change the target of the analysis results display
from a light window to your own div element by setting the global
property <b>JS9.globalOpts.analysisDiv</b> to the id of your new
target div. The div must have CSS height and width properties if you
are going to plot results.

<h5 id="JS9.SubmitAnalysis">Run a server-side analysis task, utilizing
parameters in a form</h5>
<p>
<code class="api">JS9.SubmitAnalysis(el, name, func)</code>
<p>
where:
<ul>
<li><b>el</b>: form element (unused at present)
<li><b>name</b>: name of analysis tool
<li><b>func</b>: optional routine to call when analysis is completed on server
</ul>
The <b>JS9.SubmitAnalysis()</b> routine is used to run an analysis
task with input parameters from a form. Typically used as
the <b>Run</b> button action in a form, it automatically serializes
the form values and passes them to the JS9 analysis macro expander so
that these values can be integrated into the analysis command line.
See js9analysis.html for a simple example.
<p>
The <b>func</b> callback and global options are the same as
for
<a href="#JS9.RunAnalysis"><b>JS9.RunAnalysis()</b></a>
above.

<p><hr>
  
<h4 id="displays">Working with Displays</h4>

<h5 id="JS9.LookupDisplay">Lookup a JS9 display</h5>
<p>
<code class="api">dobj = JS9.LookupDisplay(dname, mustExist)</code>
<p>
where:
<ul>
<li><b>dname</b>: name of JS9 display to look up
<li><b>mustExist</b>: whether to throw error if a dname display does not exist
</ul>
returns:
<ul>
<li><b>dobj</b>: the JS9 display object
</ul>
The <b>JS9.LookupDisplay()</b> routine returns the display object associated
with the specified <b>dname</b> parameter. If no <b>dname</b> is specified,
the first available display is returned.
<p>
If <b>dname</b> is specified but does not exist, an error is thrown unless
the <b>mustExist</b> parameter is explicitly set to false (i.e., the default
is that the id must exist).

<h5 id="JS9.ResizeDisplay">Resize the JS9 Display</h5>
<p>
<code class="api">JS9.ResizeDisplay(dname, width, height, opts)</code>
<p>
where:
<ul>
<li><b>dname</b>: optional name of JS9 display to resize
<li><b>width</b>: new width of the display in HTML pixels (or "full" or "reset")
<li><b>height</b>: new height of the display in HTML pixels
<li><b>opts</b>: optional object containing resize parameters
</ul>
You can resize the JS9 display element by supplying new width and
height parameters. The div on the web page will be resized and the
image will be re-centered in the new display. If the display size has
been increased, more of the image will be displayed as needed (up to
the new size of the display). For example, if the original display was
512x512 and you increase it to 1024x1024, a 1024x1024 image will now
be displayed in its entirety.

<p>
If the first argument is <b>full</b>, the display is resized to match
the browser window.innerWidth and window.innerHeight variables, which
are the width and height (in pixels) of the browser window
viewport. You can then scroll the window so that the image fills the
entire browser window.  Alternatively, if the first argument
is <b>reset</b>, the display is resized to match its original size.

<p>
The opts object can contain the following properties:
<ul>
<li><b>resizeMenubar</b>: change the width of the menubar as well
</ul>
The default for <b>resizeMenubar</b> is <b>true</b>, so you only need
to pass this property if you do not want to perform the resize.
<p>
If no arguments are passed to this routine, it returns an object
containing the current display width and height. Otherwise, the
display object is returned.
<p>
You can supply a display name as the first argument, or the display object:
<pre>
    JS9.ResizeDisplay("myJS9", 350, 400);
</pre>
or:
<pre>
    JS9.ResizeDisplay(350, 400, {display: "myJS9"});
</pre>

<h5 id="JS9.MoveToDisplay">Move an image to a new JS9 display</h5>
<p>
<code class="api">JS9.MoveToDisplay(dname)</code>
<p>
where:
<ul>
<li><b>dname</b>: name of JS9 display to which the image will be moved
</ul>
The <b>JS9.MoveToDisplay()</b> routine moves the current image to the
specified display:
<pre>
    JS9.MoveToDisplay("myJS9", {display: "JS9"});
</pre>
will move the current image displayed in the "JS9" display window to
the "myJS9" window. 
<p>
Note that the new JS9 display must already exist. New displays can be
created with the
<a href="#JS9.LoadWindow"><b>JS9.LoadWindow()</b></a>
public access routine or
the <b>File:new JS9 light window</b> menu option.

<h5 id="JS9.GatherDisplay">Gather other images to this JS9 Display</h5>
<p>
<code class="api">JS9.GatherDisplay(dname)</code>
<p>
where:
<ul>
<li><b>dname</b>: name of JS9 display to which the images will be gathered
</ul>
<p>
This routine move all images in other displays to this display. 
You can supply a display name or the display object:
<pre>
    JS9.GatherDisplay("myJS9");
</pre>
or:
<pre>
    JS9.GatherDisplay({display: "myJS9"});
</pre>

<h5 id="JS9.SeparateDisplay">Separate images in this JS9 Display into new displays</h5>
<p>
<code class="api">JS9.SeparateDisplay(dname, opts)</code>
<p>
where:
<ul>
<li><b>dname</b>: name of JS9 display from which the images will be separated
<li><b>opts</b>: optional object for layout properties
</ul>
This routine moves each image in the specified display to a new display.
You can supply a display name or the display object:
<pre>
    JS9.SeparateDisplay("myJS9");
</pre>
or:
<pre>
    JS9.SeparateDisplay({display: "myJS9"});
</pre>
You also can supply an opts object containing the layout properties:
<ul>
<li><b>layout</b>: can be "horizontal", "vertical", "auto" (default: "auto")
<li><b>leftMargin</b>: margin in pixels between horizontally separated images
<li><b>topMargin</b>: margin in pixels between vertically separated images
<li><b>idbase</b>: base string for ids of separated displays
</ul>
The "horizontal" layout will generate a single row of images. The
"vertical" layout will generate a single column of images.  The "auto"
option will layout the images in one or more rows. Each row will
contain one or more images such that at least one-half of the right-most
image is visible in the browser without the need for horizontal scrolling.
<p>
Note that you can supply the opts object without supplying the display
parameter, e.g:
<pre>
    JS9.SeparateDisplay({layout: "horizontal"});
</pre>
will separate images from the default "JS9" display in a horizontal layout.
<p>
By default, the ids of the successive JS9 displays will consist of
the original display id, followed by the string "_sep", followed by an
increasing integer (not necessarily starting at 1). If you pass
the <b>idbase</b> property in the opts object, the id of each successive
display will be the specified base id followed by an increasing integer
that does start from 1. In the latter case, it is your responsibility to
ensure that the new ids to not conflict with existing ids.

<h5 id="JS9.CenterDisplay">Scroll the JS9 display to the center of the viewport</h5>
<p>
<code class="api">JS9.CenterDisplay(dname)</code>
<p>
where:
<ul>
<li><b>dname</b>: name of JS9 display to center
</ul>
<p>
This routine scrolls this display to the center of the viewport.
You can supply a display name or the display object:
<pre>
    JS9.CenterDisplay("myJS9");
</pre>
or:
<pre>
    JS9.CenterDisplay({display: "myJS9"});
</pre>

<h5 id="JS9.CloseDisplay">Close all images in a display</h5>
<p>
<code class="api">JS9.CloseDisplay(dname)</code>
<p>
where:
<ul>
<li><b>dname</b>: name of JS9 display whose images will be closed
</ul>
<p>
This routine closes all images in the specified display.
You can supply a display name as the first argument or the display object:
<pre>
    JS9.CloseDisplay("myJS9");
</pre>
or:
<pre>
    JS9.CloseDisplay({display: "myJS9"});
</pre>

<p><hr>
  
<h4 id="misc">Miscellaneous</h4>

<h5 id="JS9.Print">Print an image</h5>
<p>
<code class="api">JS9.Print(opts)</code>
<p>
where:
<ul>
<li><b>opts</b>: options for print
</ul>
<p>
Print the currently displayed image. A new window is displayed
containing the image, along with regions and other graphical layers
(the 2D graphics having been converted to a re-scalable format).  The
standard Print dialog box also is displayed and can be used to print
this new window.  Dismiss both windows when you are finished.

<p>
By default, if a colorbar is active on the page, it will be placed
beneath the image. You can pass the <b>colorbar: false</b> option
in the <b>opts</b> object to avoid printing the active colorbar.

<h5 id="JS9.SaveFITS">Save image as a FITS file</h5>
<p>
<code class="api">JS9.SaveFITS(filename)</code>
<p>
where:
<ul>
<li><b>filename</b>: output file name
</ul>
Save the currently displayed image as a FITS file. If filename is not
specified, the file will be saved as "js9.fits".

<p>
Don't forget that the file is saved by the browser, in whatever location
you have set up for downloads.

<h5 id="JS9.SavePNG">Save image as a PNG file</h5>
<p>
<code class="api">JS9.SavePNG(filename)</code>
<p>
where:
<ul>
<li><b>filename</b>: output file name
</ul>
Save the currently displayed image as a PNG file. If filename is not
specified, the file will be saved as "js9.png". The image is saved
along with the graphical overlays (regions, etc.).

<p>
Don't forget that the file is saved by the browser, in whatever location
you have set up for downloads.

<h5 id="JS9.SaveJPEG">Save image as a JPEG file</h5>
<p>
<code class="api">JS9.SaveJPEG(filename, quality)</code>
<p>
where:
<ul>
<li><b>filename</b>: output file name
<li><b>quality</b>: a number between 0 and 1 indicating image quality
</ul>
Save the currently displayed image as a JPEG file. If filename is not
specified, the file will be saved as "js9.jpeg". The image is saved
along with the graphical overlays (regions, etc.). If quality
parameter is not specified, a suitable default is used. On FireFox (at
least), this default values is 0.95 (I think).

<p>
Don't forget that the file is saved by the browser, in whatever location
you have set up for downloads.

<h5 id="JS9.UploadFITSFile">upload currently displayed FITS file to proxy server</h5>
<p>
<code class="api">JS9.UploadFITSFile()</code>
<p>
Upload the currently displayed FITS file to the proxy server, so that
back-end analysis can be performed. This routine requires that a Node.js-based
JS9 helper is running and that the helper has enabled the <b>loadProxy</b>
property and set up a <b>workDir</b> directory in which to store the FITS file.

<h5 id="JS9.GetFITSHeader">Get FITS header as a string</h5>
<p>
<code class="api">JS9.GetFITSHeader(nlflag)</code>
<p>
where:
<ul>
<li><b>nlflag</b>: true if newlines should added to each card
</ul>
Return the FITS header as a string. By default, the returned string contains
the 80-character FITS cards all concatenated together. If <b>nlflag</b>
is <b>true</b>, each card will have a new-line appended.
<p>
Note that the
<a href="#JS9.GetImageData"><b>JS9.GetImageData()</b></a>
routine also returns the
FITS header, but as an object whose properties contain the header
values. For example, obj.SIMPLE will usually have a value of true,
obj.BITPIX will have contain the bits/pixel, etc. This object is more
useful for programming tasks, but does not contain the FITS comments
associated with each header card.

<h5 id="JS9.DisplayHelp">Display help in a light window</h5>
<p>
<code class="api">JS9.DisplayHelp(name)</code>
<p>
where:
<ul>
<li><b>name</b>: name of a help file or url of a web site to display
</ul>
The help file names are the property names in JS9.helpOpts (e.g., "user" for
the user page, "install" for the install page, etc.). Alternatively, you can
specify an arbitrary URL to display (just because).

<h5 id="JS9.DisplayPlugin">Display plugin in a light window</h5>
<p>
<code class="api">JS9.DisplayPlugin(name)</code>
<p>
where:
<ul>
<li><b>name</b>: name of the plugin
</ul>
Toggle the light-window display of the named plugin, as is done by
the <b>View</b> and <b>Analysis</b> menus. That is, if the plugin is
not visible, make it visible. If the plugin is visible, hide it. 
<p>
You can supply the full class and plugin name or just the name, using
exact case or lower case, e.g.:
<ul>
<li> JS9Panner or panner
<li> JS9Magnifier or magnifier
<li> JS9Info or info
<li> JS9Console or console
<li> DataSourcesArchivesCatalogs or archivescatalogs
<li> FitsBinning or binning
<li> ImExamEncEnergy or encenergy
<li> ImExamPxTabl or pxtabl
<li> ImExamRadialProj or radialproj
<li> ImExamHistogram or histogram
<li> ImExamRegionStats or regionstats
<li> ImExamXProj or xproj
<li> ImExamYProj or yproj
<li> ImExam3dPlot or 3dplot
<li> ImExamContours or contours
</ul>
<p>
As with plugins in the View and Analysis menus, this routine does
nothing if the plugin is explicitly defined on the web page.
<p>
This routine is useful if you are building a web interface that
supports the JS9 menu functions.

<h5 id="JS9.LightWindow">Display content in a light window</h5>
<p>
<code class="api">JS9.LightWindow(id, type, content, title, opts)</code>
<p>
where:
<ul>
<li><b>id</b>: unique id for light window div(default: "lightWindow" + uniqueID)
<li><b>type</b>: content type: "inline", "div", "ajax", "iframe" (default: "inline")
<li><b>content</b>: content of the light window (default: none)
<li><b>title</b>: title (default: "JS9 light window")
<li><b>opts</b>: configuration string (default: "width=830px,height=400px,center=1,resize=1,scrolling=1")
</ul>
Display arbitrary content inside a light window. There are any number
of light window routines available on the Net. JS9 uses light window
routines developed by Dynamic Drive (http://www.dynamicdrive.com).
Their extensive documentation can be found
<a href="http://www.dynamicdrive.com/dynamicindex8/dhtmlwindow/">here</a>.

<p>
The content shown inside the window depends on the <b>content</b> parameter:
<ul>
<li> <b>iframe</b>: the URL of the page to display (ie: "http://www.google.com")
<li><b>inline</b>: the HTML to display (back-slashing any special JavaScript characters, such as apostrophes)
<li><b>ajax</b>: the relative path to the external page to display, relative to the current page (ie: "../external.htm")
<li><b>div</b>: define a DIV element on the page with a unique ID attribute (probably hidden using style="display:none") and the use the DIV's id as the content value
</ul>
JS9 typically uses the <b>inline</b> option. Note that web sites often
do not allow themselves to be embedded in an iframe, so this is an
unreliable option.

<p>
The <b>opts</b> parameter specifies options for the light window, such
as its size.  This parameter consists of a string with comma-separated
keywords, e.g.:
<pre>
    "width=830px,height=400px,center=1,resize=1,scrolling=1"
</pre>
The opts keywords, defined in the Dynamic Drive documentation, are:
width, height, left, top, center, resize, and scrolling.  The
JS9.lightOpts.dhtml object defines oft-used lightwin configurations,
and the JS9.lightOpts.dhtml.textWin property is used as the
default for this call. You can utilize these properties in your own call
to <b>JS9.LightWindow()</b> or make up your own configuration string.

<p>
As an extension to the Dynamic Drive light window support, JS9 adds the ability
to double-click the title bar in order to close the window.

<h5 id="JS9.OpenFileMenu">Use the file dialog box to load a FITS file</h5>
<p>
<code class="api">JS9.OpenFileMenu()</code>
<p>
Calling this routine brings up the browser's file dialog box. When a
FITS file is selected, if will be loaded into the JS9 display.
<p>
This routine is useful if you are building a web interface that
supports the JS9 menu functions.

<h5 id="JS9.OpenRegionsMenu">Use the file dialog box to load a region file</h5>
<p>
<code class="api">JS9.OpenRegionsMenu()</code>
<p>
Calling this routine brings up the browser file menu. When a region file is
selected, if will be loaded into the JS9 display.
<p>
This routine is useful if you are building a web interface that
supports the JS9 menu functions.

<h5 id="JS9.OpenColormapMenu">Use the file dialog box to load a colormap file</h5>
<p>
<code class="api">JS9.OpenColormapMenu()</code>
<p>
Calling this routine brings up the browser file menu. When a
json-format colormap file is selected, it will be loaded into the JS9
display. The colormap file can take one of two forms (without the comments):
<pre>
    # RGB color triplets for the I8 colormap in a "colors" property
    {"name":"i8","colors":[[0,0,0],[0,1,0],[0,0,1],[0,1,1],[1,0,0],[1,1,0],[1,0,1],[1,1,1]]}

    # all 3 vertex arrays for the purple colormap in one "vertices" property
    {"name":"purple","vertices":[[[0,0],[1,1]],[[0,0],[0,0]],[[0,0],[1,1]]]}
</pre>
This routine is useful if you are building a web interface that
supports the JS9 menu functions. See
<a href="#JS9.AddColormap"><b>JS9.AddColormap()</b></a> for more
information about colormap formats.

<h5 id="JS9.GetToolbar">Get toolbar values from the Toolbar plugin</h5>
<p>
<code class="api">val = JS9.GetToolbar(type)</code>
<p>
where:
<ul>
<li><b>type</b>: type of information to retrieve
</ul>
returns:
<ul>
<li><b>val</b>: array of tool objects (or an argument-dependent return)
</ul>
The <b>JS9.GetToolbar()</b> routine returns global information about the Toolbar
plugin. If the first argument is "showTooltips", the returned value specifies
whether tooltips are currently displayed. Otherwise an array of tool objects is
returned, one for each of the defined tools in the toolbar.

<h5 id="JS9.SetToolbar">Set toolbar values for the Toolbar plugin</h5>
<p>
<code class="api">JS9.SetToolbar(arg1, arg2)</code>
<p>
where:
<ul>
<li><b>arg1</b>: a type-dependent id or value to set
<li><b>arg2</b>: a type-dependent value to set
</ul>
The <b>JS9.SetToolbar()</b> routine sets global information about the Toolbar
plugin. The following values can be specified as the first argument:
<ul>
<li><b>init</b>: the text "init" triggers a re-initialization of all
display Toolbar plugins, which is useful if you have changed
the <b>JS9.globalOpts.toolBar</b> array to specify a new set of
top-level tools.
<li><b>showTooltips</b>: the text "showTooltips" uses the value of the
boolean arg2 to specify whether tooltips are displayed as the mouse hovers
over a tool.
<li><b>[text]</b>: other text is assumed to be a JSON-formatted text
containing either a new tool to add to the toolbar, or an array of tools.
<li><b>[object]</b>: an object is assumed to be new tool to add to the toolbar
<li><b>[array]</b>: an array is assumed to be an array of new tools to add to the toolbar
</ul>
New tools can be added to the toolbar at any time using this routine. The 
text properties associated with a tool object are:
<ul>
<li><b>name</b>: name of the tool
<li><b>tip</b>: a tooltip to display when the mouse hovers over the tool
<li><b>image</b>: url (relative to the install directory) containing a PNG
image file to display as the tool icon
<li><b>cmd</b>: name of the JS9 public routine to execute when the tool is
clicked
<li><b>args</b>: array of arguments to pass to the JS9 public routine
</ul>
Only the name and cmd properties are required. If no image is
specified, a button labeled by the name value will be used.

<p>
Examples of tool objects:
<pre>
  {
    "name": "linear",
    "tip": "linear scale",
    "image": "images/toolbar/dax_images/lin.png",
    "cmd": "SetScale",
    "args": ["linear"]
  },
  {
    "name": "histeq",
    "tip": "histogram equalization",
    "cmd": "SetScale",
    "args": ["histeq"]
  },
  {
    "name": "annulus",
    "tip": "annulus region",
    "image": "images/toolbar/dax_images/annulus.png",
    "cmd": "AddRegions",
    "args": ["annulus"]
  },
  {
    "name": "remove",
    "tip": "remove selected region",
    "image": "images/toolbar/dax_images/erase.png",
    "cmd": "RemoveRegions",
    "args": ["selected"]
  },
  {
    "name": "zoom1",
    "tip": "zoom 1",
    "image": "images/toolbar/dax_images/mag_one.png",
    "cmd": "SetZoom",
    "args": [1]
  },
  {
    "name": "magnifier",
    "tip": "toggle magnifier display",
    "image": "images/toolbar/dax_images/mag.png",
    "cmd": "DisplayPlugin",
    "args": ["JS9Magnifier"]
  }
</pre>
Each time a tool is added to the list of available tools, the active
Toolbar plugins will be re-initialized to display that tool. By default,
the new tool not be added to the top-level list: you must also edit
the <b>JS9.globalOpts.toolBar</b> array to add the name of the
tool. If this is done after you add the tool, remember to re-initialize
active toolbars by calling:
<pre>
    JS9.SetToolbar("init");
</pre>

<h5 id="JS9.InstallDir">Get location of JS9 installation directory</h5>
<p>
<code class="api">rpath = JS9.InstallDir(file)</code>
<p>
where:
<ul>
<li><b>file</b>: file or directory to convert
</ul>
returns:
<ul>
<li><b>rpath</b>: path of the file relative to the JS9 install directory
</ul>
Sometimes a plugin needs to load an auxiliary file inside the plugins
sub-directory. The web page loading the plugin has an arbitrary
location relative to the JS9 install directory, so this routine
returns a relative path to the js9 install directory.

<h5 id="JS9.Send">Send a message to a back-end server</h5>
<p>
<code class="api">JS9.Send(msg, obj, cb)</code>
<p>
where:
<ul>
<li><b>msg</b>: name of the msg, as defined in the back-end server
<li><b>obj</b>: object containing msg parameters
<li><b>cb</b>: callback to call when back-end server returns its results
</ul>
JS9 sends various internal messages to the back-end server using either
socket.io protocol (in the Node.js implementation) or CGI. For
example, when a remote analysis call is made, JS9 sends a message to the
back-end server detailing the task to call, parameters to pass, etc. Results
are then returned to JS9 for display. JS9 also sends messages to the
back-end server when a new image is displayed, when a FITS file is to 
be converted into a PNG representation file, etc.
<p>
Communication with the back-end is usually done behind the scenes and
need not concern users or application programmers. However, if you
write your own socket.io-based server, you might want to add
project-specific messages to your implementation. For example, a
Perl-based or Python-based server might add its own special messages
that execute Perl or Python commands within the server in response to
JS9 messages. In this case, you can use
<a href="#JS9.Send"><b>JS9.Send()</b></a>
to send a message to these message handlers.
<p>
The <b>msg</b> name is the name of the message, as defined by the
server. By convention, an object is usually passed to the
message handler. JS9 will add a <b>dataPath</b> property to this
object to indicate the current list of directories in which to
search for data. All other properties are specific to the message being handled.
You can pass a null instead of an object and
<a href="#JS9.Send"><b>JS9.Send()</b></a>
will generate
a temporary object to hold the dataPath.
<p>
The <b>cb</b> function will be called if the message sends an
acknowledgment.  The arguments passed to this function call by the server
are specific to the message being handled.
<p>
For example, you can send a message to the back-end server to retrieve the
list of available analysis tasks and then display this list using the call:
<pre>
    JS9.Send("getAnalysis", null, function(s){alert(s)});
</pre>
The "getAnalysis" message passes no parameters to the server. The
server returns a list of available analysis tasks in json format.

<h5 id="JS9.AddDivs">Add a JS9 display div and/or associated plugins</h5>
<p>
<code class="api">JS9.AddDivs(id1, id2, ...)</code>
<p>
where:
<ul>
<li><b>id1, id2, ...</b>: optional name(s) of new JS9 display div(s)
</ul>
You can add new JS9 displays and/or plugins dynamically. To do this, you
create the new divs, add them to the web page, and then call this routine to
incorporate them into JS9.
<p>
The routine will accept a list of JS9 display divs to initialize.  If
all you are doing is adding one or more plugins to an existing display,
leave the argument list empty.
<p>
For example, to add a new JS9 display and menubar at the end of a web
page and load an image into that display:
<pre>
    var html = "&lt;div class='JS9Menubar' id='myJS9Menubar'&gt;&lt;/div&gt;&lt;div class='JS9' id='myJS9'&gt;&lt;/div&gt;";
    // jquery append to end of page
    $(html).appendTo($("body"));
    // create the new JS9 display, with associated plugins
    JS9.AddDivs("myJS9");
    // just a standard load to that display
    JS9.Load("foo.fits", {scale: "log"}, {display: "myJS9"});
</pre>
See also
<a href="#JS9.LoadWindow"><b>JS9.LoadWindow()</b></a>
for a nice way to load images into a
light-weight or completely new window.

<h5 id="JS9.InstantiatePlugins">Instantiate plugins on this web page</h5>
<p>
<code class="api">JS9.InstantiatePlugins()</code>
<p>
Normally, JS9 will instantiate all of its plugins automatically once the page
is loaded and ready: internally, jQuery $(document).ready() calls JS9.init().
However, module loaders such as <a href="http://requirejs.org">Require.js</a>
can load scripts asynchronously and cause jQuery $(document).ready() to fire
before all JS9 scripts are available. The
<a href="#JS9.RegisterPlugin"><b>RegisterPlugin()</b></a>
routine should deal properly with this situation. But just in case ...
the <b>JS9.InstantiatePlugins()</b> will perform the plugin instantiation 
explicitly.
<p>
In you find you need to call this routine in order make your in-page
plugins display properly, please let us know the circumstances.

<p><hr>
  
<h4 id="proto">Prototype Routines (not ready for prime time)</h4>
  
<p>
NB: The routines in this section are prototypes and therefore are
subject to change. Feel free to contact us to discuss your needs so
that we can gain a better understanding of what is required in these cases.

<h5 id="JS9.LoadAuxFile">Load an auxiliary file</h5>
<p>
<code class="api">JS9.LoadAuxFile(name, func)</code>
<p>
where:
<ul>
<li><b>name</b>: class name of auxiliary file to load
<li><b>func</b>: function to call once the file is loaded
</ul>
<p> It sometimes is desirable to process auxiliary files when an image
is first loaded.  Examples include overlaying an image mask on an
image, and pre-loading regions from a region file.
The <b>JS9.LoadAuxFile</b> prototypes this sort of functionality.
<p>
Auxiliary files are defined in the js9Prefs.json file by means of the
JS9.auxfiles array containing one or more auxfile objects.  Each
auxfile specification has the following properties:
<ul>
<li><b>type</b>: type of auxiliary file: currently "mask" or "region"
<li><b>name</b>: the class name of the auxiliary file
<li><b>image</b>: image (or template) for which this auxfile is valid
<li><b>url</b>: URL of the auxfile
</ul>
For example, the following defines two auxfiles:
<pre>
    "auxFiles":   [{"type":	     "mask",
  		    "name":	     "sciencemasks",
		    "image": 	     "casa.*.png",
		    "url":	     "../myauxfiles/casa-mask.png"},
		   {"type":	     "regions",
		    "name":	     "scienceregions",
		    "image": 	     "casa.*.png",
		    "url":	     "../myauxfiles/casa.reg"}],
</pre>
Here, a mask auxfile and a regions auxfile are defined for Cas-A
dataset(s). These auxfiles are brought into play as follows:
<pre>
    // run this routine after loading each image
    function onImageLoad(im){
      JS9.LoadAuxFile("sciencemasks", function(im, aux){
        // if we succeed in loading the mask, set up the onchange callback
        im.onregionschange = regionOnChange;
        // view the image through the mask data
        im.maskData = aux.im.raw.data;
        // I mean now!
	im.displayImage("all");
      });
    JS9.LoadAuxFile("scienceregions");
  }

  // tell JS9 about the onload callback
  JS9.imageOpts.onload = onImageLoad;
</pre>
An onImageLoad function is defined that will try to load auxfiles of
types "sciencemasks" and "scienceregions". This routine is set to
be called whenever a new image is loaded.
<p>
On image load, when <b>JS9.LoadAuxFile()</b> is called, it looks in
the list of known auxfiles for an entry that matches both
the class name and the image name.  If found (in the example above,
for Cas-A datasets), the associated auxfile URL is loaded and
type-specific processing is performed:
<ul>
<li><b>masks</b>: the mask file is loaded into the web page as an
off-screen image and an aux object is created as a property of the
image object. This aux object can be used for subsequent processing
(see below).
<li><b>regions</b>: the regions in the region file are created and
displayed on the image.
</ul>
Once the initial auxfile processing has been performed, the optional
callback function will be called. For the "mask" example above, the
onregionchange property is set to call a JavaScript function (not
shown here) whenever a region changes. The maskData property is set to
point to the raw data of the auxfile (i.e., aux.im.raw.data). Finally,
the image is re-displayed. Setting the maskData property and
redisplaying the image causes the auxfile's data to be displayed as an
opaque overlay on top of the currently displayed image.
<p>
As should be clear from the description above, considerable "black
magic" currently is involved when processing auxiliary files.
Visibility is required into the inner properties of the image
object. Please contact us if you want to work with auxiliary files, so
that we can continue to think about what is required for their support.


<p><hr>
  
<h4 id="history">API Change History</h4>
  
<p>
The JS9 Public API is meant to be stable and well-documented. If we are
forced to make an incompatible change to the API, it will be documented here.

<h5>20180322: DisplaySection now uses current values for unspecified properties</h5>

<p>
Prior to JS9 version 2.1,
<a href="#JS9.DisplaySection"><b>DisplaySection()</b></a> always used
the center of the file, along with dimensions and binning specified by
the JS9.globalOpts.table and JS9.globalOpts.image objects, if these
properties were not explicitly specified. This was just wrong: it
meant that you could not set up a section and then repeated change the
filter or position without re-specifying the current section
parameters. We therefore changed the default behavior so that unspecified
properties take on the current values. To use the original defaults,
simply specify 0 for xcen and ycen, and use the globalOpts values
for dimensions and binning.

<h5>20151218: OpenFileMenu and OpenRegionsMenu don't require a display argument</h5>

<p>
The routines
<a href="#JS9.OpenFileMenu"><b>OpenFileMenu()</b></a>
and
<a href="#JS9.OpenRegionsMenu"><b>OpenRegionsMenu()</b></a>
required a display argument, instead of utilizing the standard
optional display object. This mistake has been corrected, with the
result that both routines now target the default display, as expected,
if no display is passed.

<h5>20141117: The Set routines now return "OK" instead of true on success</h5>

<p>
The public Set routines
(<a href="#JS9.SetZoom"><b>SetZoom()</b></a>,
<a href="#JS9.SetColormap"><b>SetColormap()</b></a>, etc)
were returning a boolean true when successful. This has been changed
to "OK", to make it clear that the return value is a status value,
not a boolean data value.

<h5>20141028: callback function to RunAnalysis and SubmitAnalysis</h5>

<p>
Due to an oversight, the signature of the callback function supplied to
<a href="#JS9.RunAnalysis"><b>RunAnalysis()</b></a>
(and its derivative function, 
<a href="#JS9.SubmitAnalysis"><b>SubmitAnalysis()</b></a>)
was missing the errcode argument. 
To correct this mistake, the signature was changed from:
<pre>
    func(stdout, stderr, aobj)
</pre>
to:
<pre>
    func(stdout, stderr, errcode, aobj)
</pre>
See js9onchange.html for an example of using this callback function.

<p><hr><p>

<h5>Last updated: March 22, 2018</h5>
</div>

</body>
</html>
